var ajaxChat={settingsInitiated:null,styleInitiated:null,initializeFunction:null,finalizeFunction:null,loginChannelID:null,loginChannelName:null,timerRate:null,timerRateReset:null,timer:null,ajaxURL:null,baseURL:null,regExpMediaUrl:null,dirs:null,startChatOnLoad:null,chatStarted:null,domIDs:null,dom:null,settings:null,nonPersistentSettings:null,unusedSettings:null,bbCodeTags:null,colorCodes:null,emoticonCodes:null,emoticonFiles:null,soundFiles:null,sounds:null,soundTransform:null,siteName:null,sessionName:null,sessionKeyPrefix:null,cookieExpiration:null,cookiePath:null,cookieDomain:null,cookieSecure:null,chatBotName:null,chatBotID:null,chatBotRole:null,allowUserMessageDelete:null,inactiveTimeout:null,privateChannelDiff:null,privateMessageDiff:null,showChannelMessages:null,messageTextMaxLength:null,socketServerEnabled:null,socketServerHost:null,socketServerPort:null,socketServerChatID:null,socket:null,socketIsConnected:null,socketTimerRate:null,socketReconnectTimer:null,socketRegistrationID:null,userID:null,userName:null,userRole:null,pmCount:null,channelID:null,channelName:null,channelSwitch:null,usersList:null,userNamesList:null,userMenuCounter:null,encodedUserName:null,userNodeString:null,ignoredUserNames:null,lastID:null,localID:null,lang:null,langCode:null,baseDirection:null,originalDocumentTitle:null,blinkInterval:null,httpRequest:null,retryTimer:null,retryTimerDelay:null,requestStatus:null,DOMbuffering:null,DOMbuffer:null,DOMbufferRowClass:null,inUrlBBCode:null,flashSounds:null,debug:null,init:function(e,t,i,s,a,n,r){this.httpRequest={},this.usersList=[],this.userNamesList=[],this.userMenuCounter=0,this.lastID=0,this.localID=0,this.lang=t,this.requestStatus="ok",this.DOMbufferRowClass="rowOdd",this.inUrlBBCode=!1,this.pmCount=0,this.timeStamp=new Date,this.initConfig(e),this.initDirectories(),i&&this.initSettings(),s&&this.initStyle(),this.initializeFunction=n,this.finalizeFunction=r,a&&this.setLoadHandler()},initConfig:function(e){this.token=e.token,this.loginChannelID=e.loginChannelID,this.loginChannelName=e.loginChannelName,this.timerRate=e.timerRate,this.timerRateReset=this.timerRate,this.ajaxURL=e.ajaxURL,this.baseURL=e.baseURL,this.regExpMediaUrl=e.regExpMediaUrl,this.startChatOnLoad=e.startChatOnLoad,this.domIDs=e.domIDs,this.settings=e.settings,this.nonPersistentSettings=e.nonPersistentSettings,this.bbCodeTags=e.bbCodeTags,this.colorCodes=e.colorCodes,this.emoticonCodes=e.emoticonCodes,this.emoticonFiles=e.emoticonFiles,this.emoticonDisplay=e.emoticonDisplay,this.soundFiles=e.soundFiles,this.siteName=e.siteName,this.sessionName=e.sessionName,this.sessionKeyPrefix=e.sessionKeyPrefix,this.cookieExpiration=e.cookieExpiration,this.cookiePath=e.cookiePath,this.cookieDomain=e.cookieDomain,this.cookieSecure=e.cookieSecure,this.chatBotName=e.chatBotName,this.chatBotID=e.chatBotID,this.chatBotRole=e.chatBotRole,this.allowUserMessageDelete=e.allowUserMessageDelete,this.inactiveTimeout=Math.max(e.inactiveTimeout,2),this.privateChannelDiff=e.privateChannelDiff,this.privateMessageDiff=e.privateMessageDiff,this.showChannelMessages=e.showChannelMessages,this.messageTextMaxLength=e.messageTextMaxLength,this.socketServerEnabled=e.socketServerEnabled,this.socketServerHost=e.socketServerHost,this.socketServerPort=e.socketServerPort,this.socketServerChatID=e.socketServerChatID,this.debug=e.debug,this.DOMbuffering=!1,this.DOMbuffer="",this.anonymizer=e.anonLink,this.retryTimerDelay=(6e3*this.inactiveTimeout-this.timerRate)/4+this.timerRate},initDirectories:function(){this.dirs={},this.dirs.emoticons="./images/smilies/",this.dirs.sounds="./media/sounds/",this.dirs.flash="./media/flash/"},initSettings:function(){var e,t,i,s,a,n,r=this.readCookie(this.sessionKeyPrefix+"settings");if(this.settingsInitiated=!0,this.unusedSettings={},r)for(t=r.split("&"),e=0;e<t.length;e++)if(2===(i=t[e].split("=")).length){switch(s=i[0],a=this.decodeText(i[1])){case"true":a=!0;break;case"false":a=!1;break;case"null":a=null;break;default:n=parseFloat(a),isNaN(n)||(a=parseInt(n)===n?parseInt(n):n)}this.inArray(this.nonPersistentSettings,s)?this.unusedSettings[s]=a:this.settings[s]=a}},persistSettings:function(){var e;if(this.settingsInitiated){e=[];for(var t in this.settings){if(this.inArray(this.nonPersistentSettings,t)){if(!this.unusedSettings||!this.unusedSettings[t])continue;this.settings[t]=this.unusedSettings[t]}e.push(t+"="+this.encodeText(this.settings[t]))}this.createCookie(this.sessionKeyPrefix+"settings",e.join("&"),this.cookieExpiration)}},getSettings:function(){return this.settings},getSetting:function(e){for(var t in this.settings)if(t===e)return this.settings[e];return null},setSetting:function(e,t){this.settings[e]=t},initializeSettings:function(){this.settings.persistFontColor&&this.settings.fontColor&&this.dom.inputField&&(this.dom.inputField.style.color=this.settings.fontColor)},initialize:function(){this.setUnloadHandler(),this.initializeDocumentNodes(),this.loadPageAttributes(),this.initEmoticons(),this.initColorCodes(),this.initializeSettings(),this.setSelectedStyle(),this.customInitialize(),this.setStatus("retrying"),"function"==typeof this.initializeFunction&&this.initializeFunction(),this.isCookieEnabled()?this.startChatOnLoad?this.startChat():(this.setStartChatHandler(),this.requestTeaserContent()):this.addChatBotMessageToChatList("/error CookiesRequired")},requestTeaserContent:function(){var e="&view=teaser";e+="&getInfos="+this.encodeText("userID,userName,userRole"),isNaN(parseInt(this.loginChannelID))?null!==this.loginChannelName&&(e+="&channelName="+this.encodeText(this.loginChannelName)):e+="&channelID="+this.loginChannelID,this.updateChat(e)},setStartChatHandler:function(){this.dom.inputField&&(this.dom.inputField.onfocus=function(){ajaxChat.startChat(),ajaxChat.dom.inputField.onfocus=""})},startChat:function(){this.chatStarted=!0,this.dom.inputField&&this.settings.autoFocus&&this.dom.inputField.focus(),this.checkFlashSounds(),this.socketServerEnabled||this.flashSounds?this.loadFlashInterface():this.initializeHTML5Sounds(),this.startChatUpdate()},loadPageAttributes:function(){var e=document.getElementsByTagName("html")[0];this.langCode=e.getAttribute("lang")?e.getAttribute("lang"):"en",this.baseDirection=e.getAttribute("dir")?e.getAttribute("dir"):"ltr"},setLoadHandler:function(){var e=this;this.addEvent(window,"load",function(){e.initialize()})},setUnloadHandler:function(){var e=window.onunload;window.onunload="function"!=typeof e?function(){ajaxChat.finalize()}:function(){ajaxChat.finalize(),e()}},updateDOM:function(e,t,i,s){var a=this.dom[e]?this.dom[e]:document.getElementById(e);if(a)try{a.cloneNode(!1).innerHTML=t,s?a.innerHTML=t:i?"chatList"===e?a.insertAdjacentHTML("afterbegin",t):a.innerHTML=t+a.innerHTML:"chatList"===e?a.insertAdjacentHTML("beforeend",t):a.innerHTML+=t}catch(t){this.DOMbuffer="",this.addChatBotMessageToChatList("/error DOMSyntax "+e),this.updateChatlistView()}},initializeDocumentNodes:function(){this.dom={};for(var e in this.domIDs)this.dom[e]=document.getElementById(this.domIDs[e])},initEmoticons:function(){this.DOMbuffer="";for(var e=0;e<this.emoticonCodes.length;e++)this.emoticonCodes[e]=this.encodeSpecialChars(this.emoticonCodes[e]),2!==this.emoticonDisplay[e]&&3!==this.emoticonDisplay[e]||this.dom.emoticonsContainer&&(this.DOMbuffer=this.DOMbuffer+"<a href=\"javascript:ajaxChat.insertText('"+this.scriptLinkEncode(this.emoticonCodes[e])+'\');"><img src="'+this.dirs.emoticons+this.emoticonFiles[e]+'" alt="'+this.emoticonCodes[e]+'" title="'+this.emoticonCodes[e]+'"/></a>');this.dom.emoticonsContainer&&this.updateDOM("emoticonsContainer",this.DOMbuffer),this.DOMbuffer=""},initColorCodes:function(){if(this.dom.colorCodesContainer){this.DOMbuffer="";for(var e=0;e<this.colorCodes.length;e++)this.DOMbuffer=this.DOMbuffer+"<a href=\"javascript:ajaxChat.setFontColor('"+this.colorCodes[e]+'\');" style="background-color:'+this.colorCodes[e]+';" title="'+this.colorCodes[e]+'" onclick="this.parentNode.style.display = \'none\';"></a>\n';this.updateDOM("colorCodesContainer",this.DOMbuffer),this.DOMbuffer=""}},startChatUpdate:function(){var e="userID,userName,userRole,channelID,channelName";this.socketServerEnabled&&(e+=",socketRegistrationID");var t="&getInfos="+this.encodeText(e);isNaN(parseInt(this.loginChannelID))?null!==this.loginChannelName&&(t+="&channelName="+this.encodeText(this.loginChannelName)):t+="&channelID="+this.loginChannelID,this.updateChat(t)},updateChat:function(e){var t=this.ajaxURL+"&lastID="+this.lastID;e&&(t+=e),this.makeRequest(t,"GET",null)},loadFlashInterface:function(){this.dom.flashInterfaceContainer&&!this.dom.flashInterfaceContainer.flashLoaded&&(this.updateDOM("flashInterfaceContainer",'<object id="ajaxChatFlashInterface" style="position:absolute; left:-100px;" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="'+window.location.protocol+'//download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" height="1" width="1"><param name="flashvars" value="bridgeName=ajaxChat"/><param name="src" value="'+this.dirs.flash+'FABridge.swf"/><embed name="ajaxChatFlashInterface" type="application/x-shockwave-flash" pluginspage="'+window.location.protocol+'//www.macromedia.com/go/getflashplayer" src="'+this.dirs.flash+'FABridge.swf" height="1" width="1" flashvars="bridgeName=ajaxChat"/></object>'),FABridge.addInitializationCallback("ajaxChat",this.flashInterfaceLoadCompleteHandler),this.dom.flashInterfaceContainer.flashLoaded=!0)},setAudioBackend:function(e){this.setSetting("audioBackend",e),this.checkFlashSounds(),this.flashSounds?this.loadFlashInterface():this.initializeHTML5Sounds()},checkFlashSounds:function(){if(this.settings.audioBackend<0)if(-1!==navigator.appVersion.indexOf("MSIE")){var e=!1;try{e=Boolean(new ActiveXObject("ShockwaveFlash.ShockwaveFlash"))}catch(t){e=void 0!==navigator.mimeTypes["application/x-shockwave-flash"]}this.flashSounds=e}else(navigator.plugins&&!navigator.plugins["Shockwave Flash"]||navigator.mimeTypes&&!navigator.mimeTypes["application/x-shockwave-flash"])&&(this.flashSounds=!1);else this.flashSounds=1===this.settings.audioBackend},flashInterfaceLoadCompleteHandler:function(){ajaxChat.initializeFlashInterface()},initializeFlashInterface:function(){this.socketServerEnabled&&(this.socketTimerRate=60*(this.inactiveTimeout-1)*1e3,this.socketConnect()),this.loadFlashSounds(),this.initializeCustomFlashInterface()},socketConnect:function(){if(!this.socketIsConnected)try{!this.socket&&FABridge.ajaxChat&&(this.socket=FABridge.ajaxChat.create("flash.net.XMLSocket"),this.socket.addEventListener("connect",this.socketConnectHandler),this.socket.addEventListener("close",this.socketCloseHandler),this.socket.addEventListener("data",this.socketDataHandler),this.socket.addEventListener("ioError",this.socketIOErrorHandler),this.socket.addEventListener("securityError",this.socketSecurityErrorHandler)),this.socket.connect(this.socketServerHost,this.socketServerPort)}catch(e){this.debugMessage("socketConnect",e)}clearTimeout(this.socketReconnectTimer),this.socketReconnectTimer=null},socketConnectHandler:function(e){ajaxChat.socketIsConnected=!0,setTimeout(ajaxChat.socketRegister,0)},socketCloseHandler:function(e){ajaxChat.socketIsConnected=!1,ajaxChat.socket&&(clearTimeout(ajaxChat.timer),ajaxChat.updateChat(null))},socketDataHandler:function(e){ajaxChat.socketUpdate(e.getData())},socketIOErrorHandler:function(e){setTimeout(function(){ajaxChat.addChatBotMessageToChatList("/error SocketIO")},0),setTimeout(ajaxChat.updateChatlistView,1)},socketSecurityErrorHandler:function(e){setTimeout(function(){ajaxChat.addChatBotMessageToChatList("/error SocketSecurity")},0),setTimeout(ajaxChat.updateChatlistView,1)},socketRegister:function(){if(this.socket&&this.socketIsConnected)try{this.socket.send('<register chatID="'+this.socketServerChatID+'" userID="'+this.userID+'" regID="'+this.socketRegistrationID+'"/>')}catch(e){this.debugMessage("socketRegister",e)}},loadXML:function(e){if(!arguments.callee.parser)try{arguments.callee.parser=new DOMParser}catch(e){var t=function(){};"Microsoft Internet Explorer"===navigator.appName?t.prototype.parseFromString=function(e,t){return arguments.callee.XMLDOM||(arguments.callee.XMLDOM=new ActiveXObject("Microsoft.XMLDOM")),arguments.callee.XMLDOM.loadXML(e),arguments.callee.XMLDOM}:t.prototype.parseFromString=function(e,t){return arguments.callee.httpRequest||(arguments.callee.httpRequest=new XMLHttpRequest),arguments.callee.httpRequest.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(e),!1),arguments.callee.httpRequest.send(null),arguments.callee.httpRequest.responseXML},arguments.callee.parser=new t}return arguments.callee.parser.parseFromString(e,"text/xml")},socketUpdate:function(e){var t=this.loadXML(e);if(t&&(this.handleOnlineUsers(t.getElementsByTagName("user")),(this.showChannelMessages||"1"!==t.firstChild.getAttribute("mode"))&&!this.channelSwitch)){var i=t.firstChild.getAttribute("channelID");i!==this.channelID&&parseInt(i)!==parseInt(this.userID)+this.privateMessageDiff||this.handleChatMessages(t.getElementsByTagName("message"))}},setAudioVolume:function(e){if(e=parseFloat(e),!isNaN(e))if(e<0?e=0:e>1&&(e=1),this.settings.audioVolume=e,this.flashSounds)try{this.soundTransform||(this.soundTransform=FABridge.ajaxChat.create("flash.media.SoundTransform")),this.soundTransform.setAudioVolume(e)}catch(e){this.debugMessage("setAudioVolumeFlash",e)}else try{for(var t in this.soundFiles)this.sounds[t].volume=e}catch(e){this.debugMessage("setAudioVolume",e)}},initializeHTML5Sounds:function(){var e,t,i,s;try{t=!(!(e=document.createElement("audio")).canPlayType||!e.canPlayType('audio/mpeg; codecs="mp3"').replace(/no/,"")),i=!(!e.canPlayType||!e.canPlayType('audio/ogg; codecs="vorbis"').replace(/no/,"")),this.sounds=[],s=i?".ogg":t?".mp3":".wav";for(var a in this.soundFiles)this.sounds[a]=new Audio(this.dirs.sounds+a+s);this.setAudioVolume(this.settings.audioVolume)}catch(e){this.debugMessage("initializeHTML5Sounds",e)}},loadFlashSounds:function(){var e,t;if(this.flashSounds)try{this.setAudioVolume(this.settings.audioVolume),this.sounds={};for(var i in this.soundFiles)(e=FABridge.ajaxChat.create("flash.media.Sound")).addEventListener("complete",this.soundLoadCompleteHandler),e.addEventListener("ioError",this.soundIOErrorHandler),(t=FABridge.ajaxChat.create("flash.net.URLRequest")).setUrl(this.dirs.sounds+this.soundFiles[i]),e.load(t)}catch(e){this.debugMessage("loadFlashSounds",e)}},soundLoadCompleteHandler:function(e){var t=e.getTarget();for(var i in ajaxChat.soundFiles)new RegExp(ajaxChat.soundFiles[i]).test(t.getUrl())&&(ajaxChat.sounds[i]=t)},soundIOErrorHandler:function(e){setTimeout(function(){ajaxChat.addChatBotMessageToChatList("/error SoundIO")},0),setTimeout(ajaxChat.updateChatlistView,1)},soundPlayCompleteHandler:function(e){},playSound:function(e){if(this.sounds&&this.sounds[e])try{return this.sounds[e].currentTime=0,this.sounds[e].play()}catch(e){this.debugMessage("playSound",e)}return null},playSoundOnNewMessage:function(e,t,i,s,a,n,r,o){var l;if(this.settings.audio&&this.sounds&&this.lastID&&!this.channelSwitch){if(!1===this.customSoundOnNewMessage(e,t,i,s,a,n,r,o))return;switch(l=n.split(" ",1),t){case this.chatBotID:switch(l[0]){case"/kick":this.playSound(this.settings.soundLeave);break;case"/error":this.playSound(this.settings.soundError);break;default:this.playSound(this.settings.soundChatBot)}break;case this.userID:switch(l[0]){case"/privmsgto":this.playSound(this.settings.soundPrivate);break;default:this.playSound(this.settings.soundSend)}break;default:switch(l[0]){case"/privmsg":this.playSound(this.settings.soundPrivate);break;default:this.playSound(this.settings.soundReceive)}}}},fillSoundSelection:function(e,t){var i=document.getElementById(e),s=1;for(var a in this.soundFiles)i.options[s]=new Option(a,a),a===t&&(i.options[s].selected=!0),s++},setStatus:function(e){"waiting"===e&&"retrying"===this.requestStatus||(this.requestStatus=e),this.dom.statusIcon&&(this.dom.statusIcon.className=this.requestStatus)},forceNewRequest:function(){ajaxChat.updateChat(null),ajaxChat.setStatus("retrying")},getHttpRequest:function(e){if(!this.httpRequest[e])if(window.XMLHttpRequest)this.httpRequest[e]=new XMLHttpRequest,this.httpRequest[e].overrideMimeType&&this.httpRequest[e].overrideMimeType("text/xml");else if(window.ActiveXObject)try{this.httpRequest[e]=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{this.httpRequest[e]=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}return this.httpRequest[e]},makeRequest:function(e,t,i){var s,a=this;a.setStatus("waiting");try{i?(!arguments.callee.identifier||arguments.callee.identifier>50?arguments.callee.identifier=1:arguments.callee.identifier++,s=arguments.callee.identifier):s=0,a.retryTimer=setTimeout(ajaxChat.forceNewRequest,ajaxChat.retryTimerDelay),a.getHttpRequest(s).open(t,e,!0),a.getHttpRequest(s).onreadystatechange=function(){try{ajaxChat.handleResponse(s)}catch(e){try{clearTimeout(ajaxChat.timer)}catch(e){a.debugMessage("makeRequest::clearTimeout",e)}try{i&&(ajaxChat.addChatBotMessageToChatList("/error ConnectionTimeout"),ajaxChat.setStatus("retrying"),ajaxChat.updateChatlistView())}catch(e){a.debugMessage("makeRequest::logRetry",e)}try{ajaxChat.timer=setTimeout(function(){ajaxChat.updateChat(null)},ajaxChat.timerRate)}catch(e){a.debugMessage("makeRequest::setTimeout",e)}}},"POST"===t&&a.getHttpRequest(s).setRequestHeader("Content-Type","application/x-www-form-urlencoded"),a.getHttpRequest(s).send(i)}catch(e){clearTimeout(this.timer),i&&(a.addChatBotMessageToChatList("/error ConnectionTimeout"),ajaxChat.setStatus("retrying"),a.updateChatlistView()),a.timer=setTimeout(function(){ajaxChat.updateChat(null)},a.timerRate)}},handleResponse:function(e){var t;if(4===this.getHttpRequest(e).readyState){if(200!==this.getHttpRequest(e).status)return 0===this.getHttpRequest(e).status?(this.setStatus("waiting"),this.updateChatlistView(),!1):(this.addChatBotMessageToChatList("/error ConnectionStatus "+this.getHttpRequest(e).status),this.setStatus("retrying"),this.updateChatlistView(),!1);clearTimeout(ajaxChat.retryTimer),t=this.getHttpRequest(e).responseXML,ajaxChat.setStatus("ok")}if(!t)return!1;var i=new Date-this.timeStamp;return console.log(this.timerRate+" "+i),i>3e5&&this.timerRate<6e4&&(this.timerRate=this.timerRate+500),i>36e5&&(this.timerRate=2e3),this.handleXML(t),!0},handleXML:function(e){this.handleInfoMessages(e.getElementsByTagName("info")),this.handleOnlineUsers(e.getElementsByTagName("user")),this.handleChatMessages(e.getElementsByTagName("message")),this.channelSwitch=null,this.setChatUpdateTimer()},setChatUpdateTimer:function(){var e;(clearTimeout(this.timer),this.chatStarted)&&(this.socketIsConnected?e=this.socketTimerRate:(e=this.timerRate,this.socketServerEnabled&&!this.socketReconnectTimer&&(this.socketReconnectTimer=setTimeout(ajaxChat.socketConnect,6e4))),this.timer=setTimeout(function(){ajaxChat.updateChat(null)},e))},handleInfoMessages:function(e){for(var t,i,s=0;s<e.length;s++)t=e[s].getAttribute("type"),i=e[s].firstChild?e[s].firstChild.nodeValue:"",this.handleInfoMessage(t,i)},handleInfoMessage:function(e,t){if(!0!==this.handleCustomInfoMessage(e,t))switch(e){case"channelSwitch":this.clearChatList(),this.clearOnlineUsersList(),this.setSelectedChannel(t),this.channelName=t,this.channelSwitch=!0;break;case"channelName":this.setSelectedChannel(t),this.channelName=t;break;case"channelID":this.channelID=t;break;case"userID":this.userID=t;break;case"userName":this.userName=t,this.encodedUserName=this.scriptLinkEncode(this.userName),this.userNodeString=null;break;case"userRole":this.userRole=t;break;case"logout":return void this.handleLogout(t);case"socketRegistrationID":this.socketRegistrationID=t,this.socketRegister();default:return}},handleOnlineUsers:function(e){if(e.length){var t,i,s,a,n,r=[];for(e.length!==this.usersList.length&&this.clearOnlineUsersList(),n=0;n<e.length;n++)if(i=e[n].getAttribute("userID"),s=e[n].firstChild?e[n].firstChild.nodeValue:"",a=e[n].getAttribute("userRole"),r.push(i),-1===(t=this.arraySearch(i,this.usersList))?this.addUserToOnlineList(i,s,a):this.userNamesList[t]!==s&&(this.removeUserFromOnlineList(i,t),this.addUserToOnlineList(i,s,a)),i===this.userID){var o=e[n].getAttribute("pmCount");0===o?(window.parent.document.title=this.siteName+" :: Home",document.title=this.siteName+" :: Chat"):(window.parent.document.title=this.siteName+" :("+o+"): Home",document.title=this.siteName+" :("+o+"): Chat");for(var l=document.getElementById("pmcount");l.firstChild;)l.removeChild(l.firstChild);l.appendChild(document.createTextNode(o)),this.pmCount=o}for(n=0;n<this.usersList.length;n++)this.inArray(r,this.usersList[n])||this.removeUserFromOnlineList(this.usersList[n],n);this.setOnlineListRowClasses(),document.getElementById("olcount").innerHTML="("+this.usersList.length+")"}},handleChatMessages:function(e){var t,i,s,a,n;if(e.length){for(n=0;n<e.length;n++)this.DOMbuffering=!0,i=(t=e[n].getElementsByTagName("username")[0]).firstChild?t.firstChild.nodeValue:"",a=(s=e[n].getElementsByTagName("text")[0]).firstChild?s.firstChild.nodeValue:"",n===e.length-1&&(this.DOMbuffering=!1),this.addMessageToChatList(new Date(e[n].getAttribute("dateTime")),e[n].getAttribute("userID"),i,e[n].getAttribute("userRole"),e[n].getAttribute("id"),a,e[n].getAttribute("channelID"),e[n].getAttribute("ip")),e[n].getAttribute("userID")!==this.chatBotID&&(this.timerRate=this.timerRateReset,this.timeStamp=new Date);this.DOMbuffering=!1,this.updateChatlistView(),this.settings.postDirection?this.lastID=e[0].getAttribute("id"):this.lastID=e[e.length-1].getAttribute("id")}},setSelectedChannel:function(e){var t,i,s,a=!1;if(this.dom.channelSelection){for(e=this.decodeSpecialChars(e),t=0;t<this.dom.channelSelection.options.length;t++)if(this.dom.channelSelection.options[t].value===e){this.dom.channelSelection.options[t].selected=!0,a=!0;break}a||(i=document.createElement("option"),s=document.createTextNode(e),i.appendChild(s),i.setAttribute("value",e),i.setAttribute("selected","selected"),this.dom.channelSelection.appendChild(i))}},removeUserFromOnlineList:function(e,t){this.usersList.splice(t,1),this.userNamesList.splice(t,1),this.dom.onlineList&&this.dom.onlineList.removeChild(this.getUserNode(e))},addUserToOnlineList:function(e,t,i){this.usersList.push(e),this.userNamesList.push(t),this.dom.onlineList&&this.updateDOM("onlineList",this.getUserNodeString(e,t,i),this.userID===e)},getUserNodeString:function(e,t,i){var s,a;return this.userNodeString&&e===this.userID?this.userNodeString:(s=this.scriptLinkEncode(t),a='<div id="'+this.getUserDocumentID(e)+'"><a href="javascript:ajaxChat.toggleUserMenu(\''+this.getUserMenuDocumentID(e)+"', '"+s+"', "+e+');" class="'+this.getRoleClass(i)+'" title="'+this.lang.toggleUserMenu.replace(/%s/,t)+'">'+t+'</a><ul class="userMenu" id="'+this.getUserMenuDocumentID(e)+'"'+(e===this.userID?">"+this.getUserNodeStringItems(s,e,!1):' style="display:none;">')+"</ul></div>",e===this.userID&&(this.userNodeString=a),a)},toggleUserMenu:function(e,t,i){var s=!1;e.indexOf("ium")>=0&&(s=!0),document.getElementById(e).firstChild||this.updateDOM(e,this.getUserNodeStringItems(this.encodeText(this.addSlashes(this.getScriptLinkValue(t))),i,s),!1,!0),this.showHide(e),this.dom.chatList.scrollTop=this.dom.chatList.scrollHeight},getUserNodeStringItems:function(e,t,i){var s;return e!==this.encodedUserName?(s="<li><a href=\"javascript:ajaxChat.insertMessageWrapper('/msg "+e+' \');" title="Private Message this user in AJAX Chat.">'+this.lang.userMenuSendPrivateMessage+'</a></li><li class="disc"><a target="_blank" href="../pm_system.php?action=send_message&amp;receiver='+t+'" title="Private Message this user using site messages.">PM User </a></li><li><a href="javascript:ajaxChat.sendMessageWrapper(\'/query '+e+'\');" title="Open a private channel between you and this user.">'+this.lang.userMenuOpenPrivateChannel+'</a></li><li><a href="javascript:ajaxChat.sendMessageWrapper(\'/query\');" title="Close a private channel between you and this user.">'+this.lang.userMenuClosePrivateChannel+"</a></li><li><a href=\"javascript:ajaxChat.sendMessageWrapper('/ignore "+e+'\');" title="(un)Ignore this user.">'+this.lang.userMenuIgnore+"</a></li><li><a href=\"javascript:ajaxChat.sendMessageWrapper('/invite "+e+'\');" title="Invite this user to your private channel.">'+this.lang.userMenuInvite+"</a></li><li><a href=\"javascript:ajaxChat.sendMessageWrapper('/uninvite "+e+'\');" title="Revoke an Invitation to this user to your private channel.">'+this.lang.userMenuUninvite+'</a></li><li class="disc"><a target="_blank" href="../userdetails.php?id='+t+'&amp;hit=1" title="Open this users profile.">Users Profile </a></li><li class="disc"><a target="_blank" href="../browse.php?search='+e+'&amp;searchin=owner&amp;incldead=1&amp;vip=0" title="View this users uploads.">Users Uploads </a></li><li class="disc"><a href="javascript:ajaxChat.sendMessageWrapper(\'/stats '+e+'\');" title="Display users site stats in chat.">Users Stats</a></li><li class="disc"><a href="javascript:ajaxChat.insertMessageWrapper(\'/gift '+e+' \');" title="Give the user a gift of Karma.">Karma Gift</a></li><li class="disc"><a href="javascript:ajaxChat.insertMessageWrapper(\'/rep '+e+' \');" title="Give the user som Rep+.">Reputation Gift</a></li><li class="disc"><a href="javascript:ajaxChat.sendMessageWrapper(\'/seen '+e+' \');" title="When did this user last talk?">Last Seen</a></li>',this.userRole>=UC_STAFF&&(s+="<li><a href=\"javascript:ajaxChat.insertMessageWrapper('/kick "+e+" ');\">"+this.lang.userMenuKick+"</a></li><li><a href=\"javascript:ajaxChat.sendMessageWrapper('/whois "+e+"');\">"+this.lang.userMenuWhois+"</a></li>")):(s='<li class="disc"><a target="_blank" href="../pm_system.php" title="How many unread site PMs you have.">Unread PM (<span id="pmcount">0</span>)</a></li><li><a href="javascript:ajaxChat.sendMessageWrapper(\'/who\');">'+this.lang.userMenuWho+'</a></li><li class="circle"><a href="#" onclick="return ajaxChat.showHide(\'statslist\');" title="Click here to toggle visibility of stats list">Stats</a><ul style="display: none;" id="statslist"><li class="disc"><a href="javascript:ajaxChat.sendMessageWrapper(\'/stats '+e+'\');" title="Display your stats in chat. [Private Message]">Your Stats</a></li><li class="disc"><a href="javascript:ajaxChat.sendMessageWrapper(\'/casino \');" title="Show Casino and BlackJack Stats.">Game Stats</a></li><li class="disc"><a href="'+window.location.protocol+"//"+window.location.host+'/hnrs.php" target="_blank">Hit and Runs</a></li><li class="disc"><a href="'+window.location.protocol+"//"+window.location.host+'/port_check.php" target="_blank">Port Check</a></li><li class="disc"><a href="javascript:ajaxChat.sendMessageWrapper(\'/mentions \');" title="Show last 25 posts that mention you by name.">Mentions</a></li></ul></li><li><a href="javascript:ajaxChat.sendMessageWrapper(\'/ignore\');">'+this.lang.userMenuIgnoreList+"</a></li><li><a href=\"javascript:ajaxChat.sendMessageWrapper('/list');\">"+this.lang.userMenuList+"</a></li><li><a href=\"javascript:ajaxChat.insertMessageWrapper('/roll ');\">"+this.lang.userMenuRoll+"</a></li><li><a href=\"javascript:ajaxChat.insertMessageWrapper('/nick ');\">"+this.lang.userMenuNick+"</a></li>",this.userRole>=UC_POWER_USER&&(s+="<li><a href=\"javascript:ajaxChat.sendMessageWrapper('/join');\">"+this.lang.userMenuEnterPrivateRoom+"</a></li>",this.userRole>=UC_STAFF&&(s+="<li><a href=\"javascript:ajaxChat.sendMessageWrapper('/bans');\">"+this.lang.userMenuBans+"</a></li>"),this.userRole>=UC_ADMINISTRATOR&&(s+='<li><a href="../ajaxchat.php?view=logs" title="View AJAX Chat Logs.">View Logs</a></li>'))),s+=this.getCustomUserMenuItems(e,t)},setOnlineListRowClasses:function(){if(this.dom.onlineList)for(var e=this.dom.onlineList.firstChild,t=!1;e;)e.className=t?"rowEven":"rowOdd",e=e.nextSibling,t=!t},clearChatList:function(){for(;this.dom.chatList.hasChildNodes();)this.dom.chatList.removeChild(this.dom.chatList.firstChild)},clearOnlineUsersList:function(){if(this.usersList=[],this.userNamesList=[],this.dom.onlineList)for(;this.dom.onlineList.hasChildNodes();)this.dom.onlineList.removeChild(this.dom.onlineList.firstChild)},getEncodedChatBotName:function(){return void 0===arguments.callee.encodedChatBotName&&(arguments.callee.encodedChatBotName=this.encodeSpecialChars(this.chatBotName)),arguments.callee.encodedChatBotName},addChatBotMessageToChatList:function(e){this.addMessageToChatList(new Date,this.chatBotID,this.getEncodedChatBotName(),this.chatBotRole,null,e,null)},addMessageToChatList:function(e,t,i,s,a,n,r,o){this.getMessageNode(a)||("Staff"===this.channelName&&parseInt(r)!==parseInt(this.channelID)||"Sysop"===this.channelName&&parseInt(r)!==parseInt(this.channelID)||"Support"===this.channelName&&parseInt(r)!==parseInt(this.channelID)||"Announce"===this.channelName&&parseInt(r)!==parseInt(this.channelID)||"News"===this.channelName&&parseInt(r)!==parseInt(this.channelID)||"Git"===this.channelName&&parseInt(r)!==parseInt(this.channelID)?this.DOMbuffering||(this.updateDOM("chatList",this.DOMbuffer,this.settings.postDirection),this.DOMbuffer=""):"Announce"===this.channelName&&100!==parseInt(s)||"News"===this.channelName&&100!==parseInt(s)||"Git"===this.channelName&&100!==parseInt(s)?this.DOMbuffering||(this.updateDOM("chatList",this.DOMbuffer,this.settings.postDirection),this.DOMbuffer=""):this.onNewMessage(e,t,i,s,a,n,r,o)?(this.DOMbufferRowClass="rowEven"===this.DOMbufferRowClass?"rowOdd":"rowEven",this.DOMbuffer=this.DOMbuffer+this.getChatListMessageString(e,t,i,s,a,n,r,o),this.DOMbuffering||(this.updateDOM("chatList",this.DOMbuffer,this.settings.postDirection),this.DOMbuffer="")):this.DOMbuffering||(this.updateDOM("chatList",this.DOMbuffer,this.settings.postDirection),this.DOMbuffer=""))},getChatListMessageString:function(e,t,i,s,a,n,r,o){var l=this.DOMbufferRowClass,h=this.getRoleClass(s),c=": ";100===s&&~n.indexOf("Member Since")&&(l+=" monospace"),0!==n.indexOf("/action")&&0!==n.indexOf("/me")&&0!==n.indexOf("/privaction")||(h+=" action",c=" "),0!==n.indexOf("/privmsg")&&0!==n.indexOf("/privmsgto")&&0!==n.indexOf("/privaction")||(l+=" private");var u=this.settings.dateFormat?'<span class="dateTime" title="'+this.formatDate(this.settings.dateFormatTooltip,e)+'">'+this.formatDate(this.settings.dateFormat,e)+"</span> ":"";return'<div id="'+this.getMessageDocumentID(a)+'" class="'+l+'">'+this.getDeletionLink(a,t,s,r)+u+'<span class="'+h+'" title="Click to use@'+i+':"'+this.getChatListUserNameTitle(t,i,s,o)+' dir="'+this.baseDirection+'" onclick="ajaxChat.insertText(\'['+this.getRoleClass(s)+"]@' + this.firstChild.nodeValue + '[/"+this.getRoleClass(s)+"] ');\">"+i+"</span>"+c+this.replaceText(n)+"</div>"},getChatListUserNameTitle:function(e,t,i,s){return null!==s?' title="IP: '+s+'"':""},getMessageDocumentID:function(e){return null===e?"ajaxChat_lm_"+this.localID++:"ajaxChat_m_"+e},getMessageNode:function(e){return null===e?null:document.getElementById(this.getMessageDocumentID(e))},getUserDocumentID:function(e){return"ajaxChat_u_"+e},getUserNode:function(e){return document.getElementById(this.getUserDocumentID(e))},getUserMenuDocumentID:function(e){return"ajaxChat_um_"+e},getInlineUserMenuDocumentID:function(e,t){return"ajaxChat_ium_"+e+"_"+t},getDeletionLink:function(e,t,i,s){return null!==e&&this.isAllowedToDeleteMessage(e,t,i,s)?(arguments.callee.deleteMessage||(arguments.callee.deleteMessage=this.encodeSpecialChars(this.lang.deleteMessage)),'<a class="delete" title="'+arguments.callee.deleteMessage+'" href="javascript:ajaxChat.deleteMessage('+e+', false);"> </a>'):""},isAllowedToDeleteMessage:function(e,t,i,s){return!!(this.userRole>=UC_USER&&this.allowUserMessageDelete&&(t===this.userID||parseInt(s)===parseInt(this.userID)+this.privateMessageDiff||parseInt(s)===parseInt(this.userID)+this.privateChannelDiff)||this.userRole>=UC_STAFF&&this.allowUserMessageDelete&&this.userRole>i||this.userRole>=UC_ADMINISTRATOR&&(this.userRole>i||i===this.chatBotRole))},onNewMessage:function(e,t,i,s,a,n,r,o){return!!this.customOnNewMessage(e,t,i,s,a,n,r,o)&&(!this.ignoreMessage(e,t,i,s,a,n,r,o)&&(!this.parseDeleteMessageCommand(n)&&(this.blinkOnNewMessage(e,t,i,s,a,n,r,o),this.playSoundOnNewMessage(e,t,i,s,a,n,r,o),!0)))},parseDeleteMessageCommand:function(e){if(0===e.indexOf("/delete")){var t=e.substr(8),i=this.getMessageNode(t);if(i){var s=i.nextSibling;try{this.dom.chatList.removeChild(i),s&&this.updateChatListRowClasses(s)}catch(e){}}return!0}return!1},blinkOnNewMessage:function(e,t,i,s,a,n,r,o){this.settings.blink&&this.lastID&&!this.channelSwitch&&t!==this.userID&&(clearInterval(this.blinkInterval),this.blinkInterval=setInterval("ajaxChat.blinkUpdate('"+this.addSlashes(this.decodeSpecialChars(i))+"')",this.settings.blinkInterval))},blinkUpdate:function(e){this.originalDocumentTitle||(this.originalDocumentTitle=document.title),arguments.callee.blink?arguments.callee.blink>this.settings.blinkIntervalNumber?(clearInterval(this.blinkInterval),document.title=this.originalDocumentTitle,arguments.callee.blink=0):(arguments.callee.blink%2!=0?document.title="[@ ] "+e+" - "+this.originalDocumentTitle:document.title="[ @] "+e+" - "+this.originalDocumentTitle,arguments.callee.blink++):(document.title="[@ ] "+e+" - "+this.originalDocumentTitle,arguments.callee.blink=1)},updateChatlistView:function(){if(this.dom.chatList.childNodes&&this.settings.maxMessages)for(;this.dom.chatList.childNodes.length>this.settings.maxMessages;)this.dom.chatList.removeChild(this.dom.chatList.firstChild);if(this.settings.autoScroll){var e=this;setTimeout(function(){e.scrollChatList()},250)}},scrollChatList:function(){this.settings.postDirection?this.dom.chatList.scrollTop=0:this.dom.chatList.scrollTop=this.dom.chatList.scrollHeight},encodeText:function(e){return encodeURIComponent(e)},decodeText:function(e){return decodeURIComponent(e)},utf8Encode:function(e){for(var t="",i=0;i<e.length;i++){var s=e.charCodeAt(i);s<128?t+=String.fromCharCode(s):s>127&&s<2048?(t+=String.fromCharCode(s>>6|192),t+=String.fromCharCode(63&s|128)):(t+=String.fromCharCode(s>>12|224),t+=String.fromCharCode(s>>6&63|128),t+=String.fromCharCode(63&s|128))}return t},utf8Decode:function(e){for(var t,i,s,a="",n=0;n<e.length;)(t=e.charCodeAt(n))<128?(a+=String.fromCharCode(t),n++):t>191&&t<224?(i=e.charCodeAt(n+1),a+=String.fromCharCode((31&t)<<6|63&i),n+=2):(i=e.charCodeAt(n+1),s=e.charCodeAt(n+2),a+=String.fromCharCode((15&t)<<12|(63&i)<<6|63&s),n+=3);return a},encodeSpecialChars:function(e){return e.replace(/[&<>'"]/g,this.encodeSpecialCharsCallback)},encodeSpecialCharsCallback:function(e){switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case"'":return"&#39;";case'"':return"&quot;";default:return e}},decodeSpecialChars:function(e){var t=new RegExp("(&amp;)|(&lt;)|(&gt;)|(&#39;)|(&quot;)","g");return e.replace(t,this.decodeSpecialCharsCallback)},decodeSpecialCharsCallback:function(e){switch(e){case"&amp;":return"&";case"&lt;":return"<";case"&gt;":return">";case"&#39;":return"'";case"&quot;":return'"';default:return e}},inArray:function(e,t){for(var i=e.length;i--;)if(e[i]===t)return!0;return!1},arraySearch:function(e,t){if(Array.prototype.indexOf)return t.indexOf(e);for(var i=t.length;i--;)if(t[i]===e)return i;return-1},stripTags:function(e){return arguments.callee.regExp||(arguments.callee.regExp=new RegExp("<\\/?[^>]+?>","g")),e.replace(arguments.callee.regExp,"")},stripBBCodeTags:function(e){return arguments.callee.regExp||(arguments.callee.regExp=new RegExp("\\[\\/?[^\\]]+?\\]","g")),e.replace(arguments.callee.regExp,"")},escapeRegExp:function(e){if(!arguments.callee.regExp){arguments.callee.regExp=new RegExp("(\\"+["^","$","*","+","?",".","|","/","(",")","[","]","{","}","\\"].join("|\\")+")","g")}return e.replace(arguments.callee.regExp,"\\$1")},addSlashes:function(e){return e.replace(/\\/g,"\\\\").replace(/\'/g,"\\'")},removeSlashes:function(e){return e.replace(/\\\\/g,"\\").replace(/\\\'/g,"'")},formatDate:function(e,t){t=null===t?new t:t;return e.replace(/%Y/g,t.getFullYear()).replace(/%m/g,this.addLeadingZero(t.getMonth()+1)).replace(/%F/g,["January","February","March","April","May","June","July","August","September","October","November","December"][t.getMonth()]).replace(/%l/g,["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][t.getDay()]).replace(/%d/g,this.addLeadingZero(t.getDate())).replace(/%H/g,this.addLeadingZero(t.getHours())).replace(/%i/g,this.addLeadingZero(t.getMinutes())).replace(/%s/g,this.addLeadingZero(t.getSeconds()))},addLeadingZero:function(e){return(e=e.toString()).length<2&&(e="0"+e),e},getUserIDFromUserName:function(e){var t=this.arraySearch(e,this.userNamesList);return-1!==t?this.usersList[t]:null},getUserNameFromUserID:function(e){var t=this.arraySearch(e,this.usersList);return-1!==t?this.userNamesList[t]:null},getRoleClass:function(e){switch(parseInt(e)){case parseInt(UC_USER):return"user";case parseInt(UC_POWER_USER):return"power_user";case parseInt(UC_VIP):return"vip";case parseInt(UC_UPLOADER):return"uploader";case parseInt(UC_MODERATOR):return"moderator";case parseInt(UC_ADMINISTRATOR):return"administrator";case parseInt(UC_SYSOP):return"sysop";case parseInt(this.chatBotRole):return"chatbot";default:return"user"}},handleInputFieldKeyDown:function(e){var t,i,s;if(13===e.keyCode&&!e.shiftKey){this.sendMessage();try{e.preventDefault()}catch(t){e.returnValue=!1}return!1}if(9===e.keyCode&&!e.shiftKey){if((t=this.dom.inputField.value)&&(i=t.match(/\w+/g).slice(-1)[0]).length>2)for(s=0;s<this.userNamesList.length;s++)if(0===this.userNamesList[s].replace("(","").toLowerCase().indexOf(i.toLowerCase())){this.dom.inputField.value=t.replace(new RegExp(i+"$"),this.userNamesList[s]);break}try{e.preventDefault()}catch(t){e.returnValue=!1}return!1}return!0},handleInputFieldKeyUp:function(e){this.updateMessageLengthCounter()},updateMessageLengthCounter:function(){this.dom.messageLengthCounter&&this.updateDOM("messageLengthCounter",this.dom.inputField.value.length+"/"+this.messageTextMaxLength,!1,!0)},sendMessage:function(e){if(e=e||this.dom.inputField.value){if(e=this.parseInputMessage(e)){clearTimeout(this.timer);var t="lastID="+this.lastID+"&text="+this.encodeText(e);this.makeRequest(this.ajaxURL,"POST",t)}this.dom.inputField.value="",this.dom.inputField.focus(),this.updateMessageLengthCounter()}},parseInputMessage:function(e){var t;if("/"===e.charAt(0)){switch((t=e.split(" "))[0]){case"/ignore":e=this.parseIgnoreInputCommand(e,t);break;case"/clear":return this.clearChatList(),!1;default:e=this.parseCustomInputCommand(e,t)}e&&this.settings.persistFontColor&&this.settings.fontColor&&(e=this.assignFontColorToCommandMessage(e,t))}else(e=this.parseCustomInputMessage(e))&&this.settings.persistFontColor&&this.settings.fontColor&&(e=this.assignFontColorToMessage(e));return e},assignFontColorToMessage:function(e){return"[color="+this.settings.fontColor+"]"+e+"[/color]"},assignFontColorToCommandMessage:function(e,t){switch(t[0]){case"/msg":case"/describe":if(t.length>2)return t[0]+" "+t[1]+" [color="+this.settings.fontColor+"]"+t.slice(2).join(" ")+"[/color]";break;case"/me":case"/action":if(t.length>1)return t[0]+" [color="+this.settings.fontColor+"]"+t.slice(1).join(" ")+"[/color]"}return e},parseIgnoreInputCommand:function(e,t){var i,s,a=this.getIgnoredUserNames();if(t.length>1){if((i=this.encodeSpecialChars(t[1]))===this.userName||i===this.getEncodedChatBotName())return this.parseIgnoreInputCommand(null,new Array("/ignore"));if(a.length>0)for(s=a.length;s--;)if(a[s]===i)return a.splice(s,1),this.addChatBotMessageToChatList("/ignoreRemoved "+i),this.setIgnoredUserNames(a),this.updateChatlistView(),null;a.push(i),this.addChatBotMessageToChatList("/ignoreAdded "+i),this.setIgnoredUserNames(a)}else 0===a.length?this.addChatBotMessageToChatList("/ignoreListEmpty -"):this.addChatBotMessageToChatList("/ignoreList "+a.join(" "));return this.updateChatlistView(),null},getIgnoredUserNames:function(){var e;return this.ignoredUserNames||(e=this.getSetting("ignoredUserNames"),this.ignoredUserNames=e?e.split(" "):[]),this.ignoredUserNames},setIgnoredUserNames:function(e){this.ignoredUserNames=e,this.setSetting("ignoredUserNames",e.join(" "))},ignoreMessage:function(e,t,i,s,a,n,r,o){var l;if(t===this.chatBotID&&"/"===n.charAt(0)&&(l=n.split(" ")).length>1)switch(l[0]){case"/invite":case"/uninvite":case"/roll":i=l[1]}return!!this.inArray(this.getIgnoredUserNames(),i)},deleteMessage:function(e,t){var i,s,a=this.getMessageNode(e);if(a){if(i=a.className,this.addClass(a,"deleteSelected"),!1===t)t=confirm(this.lang.deleteMessageConfirm);if(!0===t){s=a.nextSibling;try{this.dom.chatList.removeChild(a),s&&this.updateChatListRowClasses(s),this.updateChat("&delete="+e)}catch(e){a.className=i}}else a.className=i}},updateChatListRowClasses:function(e){var t,i;if(e||(e=this.dom.chatList.firstChild),e)for(i=!(!(t=e.previousSibling)||"rowOdd"!==t.className);e;)e.className=i?"rowEven":"rowOdd",e=e.nextSibling,i=!i},addEvent:function(e,t,i){e&&(e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i)},addClass:function(e,t){this.hasClass(e,t)||(e.className+=" "+t)},removeClass:function(e,t){e.className=e.className.replace(new RegExp("(?:^|\\s)"+t+"(?!\\S)","g"),"")},hasClass:function(e,t){return e.className.match(new RegExp("\\b"+t+"\\b"))},scriptLinkEncode:function(e){return this.encodeText(this.addSlashes(this.decodeSpecialChars(e)))},scriptLinkDecode:function(e){return this.encodeSpecialChars(this.removeSlashes(this.decodeText(e)))},getScriptLinkValue:function(e){if(void 0!==arguments.callee.utf8Decode)return arguments.callee.utf8Decode?this.utf8Decode(e):e;switch(navigator.appName){case"Microsoft Internet Explorer":case"Opera":return arguments.callee.utf8Decode=!0,this.utf8Decode(e);default:return arguments.callee.utf8Decode=!1,e}},sendMessageWrapper:function(e){this.sendMessage(this.getScriptLinkValue(e))},insertMessageWrapper:function(e){this.insertText(this.getScriptLinkValue(e),!0)},switchChannel:function(e){if(!this.chatStarted)return this.clearChatList(),this.channelSwitch=!0,this.loginChannelID=null,this.loginChannelName=e,void this.requestTeaserContent();clearTimeout(this.timer);var t="lastID="+this.lastID+"&channelName="+this.encodeText(e);this.makeRequest(this.ajaxURL,"POST",t),this.dom.inputField&&this.settings.autoFocus&&this.dom.inputField.focus()},logout:function(){clearTimeout(this.timer);this.makeRequest(this.ajaxURL+"&token="+this.token,"POST","")},handleLogout:function(e){window.location.href=e},toggleSetting:function(e,t){this.setSetting(e,!this.getSetting(e)),t&&this.updateButton(e,t)},updateButton:function(e,t){var i=document.getElementById(t);i&&(i.className=this.getSetting(e)?"button":"button off")},showHide:function(e,t,i){var s=document.getElementById(e);return s&&(t?s.style.display=t:"none"===s.style.display?s.style.display=i?"inline":"block":s.style.display="none"),!1},setPersistFontColor:function(e){this.settings.persistFontColor=e,this.settings.persistFontColor||(this.settings.fontColor=null,this.dom.inputField&&(this.dom.inputField.style.color=""))},setFontColor:function(e){this.settings.persistFontColor?(this.settings.fontColor=e,this.dom.inputField&&(this.dom.inputField.style.color=e),this.dom.colorCodesContainer&&(this.dom.colorCodesContainer.style.display="none",this.dom.inputField&&this.dom.inputField.focus())):this.insert("[color="+e+"]","[/color]")},insertText:function(e,t){t&&(this.dom.inputField.value=""),this.insert(e,"")},insertBBCode:function(e){switch(e){case"url":var t=prompt(this.lang.urlDialog,"http://");t?this.insert("[url="+t+"] ","[/url]"):this.dom.inputField.focus();break;default:this.insert("["+e+"]","[/"+e+"]")}},insert:function(e,t){if(this.dom.inputField.focus(),void 0!==document.selection){var i=document.selection.createRange(),s=i.text;i.text=e+s+t,i=document.selection.createRange(),0===s.length?i.move("character",-t.length):i.moveStart("character",e.length+s.length+t.length),i.select()}else if(void 0!==this.dom.inputField.selectionStart){var a=this.dom.inputField.selectionStart,n=this.dom.inputField.selectionEnd;s=this.dom.inputField.value.substring(a,n);this.dom.inputField.value=this.dom.inputField.value.substr(0,a)+e+s+t+this.dom.inputField.value.substr(n),r=0===s.length?a+e.length:a+e.length+s.length+t.length,this.dom.inputField.selectionStart=r,this.dom.inputField.selectionEnd=r}else{var r=this.dom.inputField.value.length;this.dom.inputField.value=this.dom.inputField.value.substr(0,r)+e+t+this.dom.inputField.value.substr(r)}},replaceText:function(e){try{e=(e=e.replace(/&amp;#039;/g,"'")).replace(/&amp;amp;/g,"&amp;"),e=this.replaceLineBreaks(e),"/"===(e=this.replaceCustomText(e)).charAt(0)?e=this.replaceCommands(e):(e=this.replaceBBCode(e),e=this.replaceBBCode(e),e=this.replaceHyperLinks(e),e=this.replaceEmoticons(e)),-1!==(e=this.breakLongWords(e)).toLowerCase().indexOf(this.userName.toLowerCase())&&(this.playSound(this.settings.soundPrivate),e='<span class="mentioned">'+e+"</span>")}catch(e){this.debugMessage("replaceText",e)}return e},replaceCommands:function(e){try{if("/"!==e.charAt(0))return e;var t=e.split(" ");switch(t[0]){case"/privmsg":return this.replaceCommandPrivMsg(t);case"/privmsgto":return this.replaceCommandPrivMsgTo(t);case"/privaction":return this.replaceCommandPrivAction(t);case"/privactionto":return this.replaceCommandPrivActionTo(t);case"/me":case"/action":return this.replaceCommandAction(t);case"/invite":return this.replaceCommandInvite(t);case"/inviteto":return this.replaceCommandInviteTo(t);case"/uninvite":return this.replaceCommandUninvite(t);case"/uninviteto":return this.replaceCommandUninviteTo(t);case"/queryOpen":return this.replaceCommandQueryOpen(t);case"/queryClose":return this.replaceCommandQueryClose(t);case"/ignoreAdded":return this.replaceCommandIgnoreAdded(t);case"/ignoreRemoved":return this.replaceCommandIgnoreRemoved(t);case"/ignoreList":return this.replaceCommandIgnoreList(t);case"/ignoreListEmpty":return this.replaceCommandIgnoreListEmpty(t);case"/kick":return this.replaceCommandKick(t);case"/who":return this.replaceCommandWho(t);case"/whoChannel":return this.replaceCommandWhoChannel(t);case"/whoEmpty":return this.replaceCommandWhoEmpty(t);case"/list":return this.replaceCommandList(t);case"/bans":return this.replaceCommandBans(t);case"/bansEmpty":return this.replaceCommandBansEmpty(t);case"/unban":return this.replaceCommandUnban(t);case"/whois":return this.replaceCommandWhois(t);case"/whereis":return this.replaceCommandWhereis(t);case"/gift":return this.replaceCommandGift(t);case"/rep":return this.replaceCommandRep(t);case"/seen":return this.replaceCommandSeen(t);case"/mentions":return this.replaceCommandMentions(t);case"/stats":return this.replaceCommandStats(t);case"/casino":return this.replaceCommandCasino(t);case"/roll":return this.replaceCommandRoll(t);case"/nick":return this.replaceCommandNick(t);case"/error":return this.replaceCommandError(t);default:return this.replaceCustomCommands(e,t)}}catch(e){this.debugMessage("replaceCommands",e)}return e},replaceCommandPrivMsg:function(e){var t=e.slice(1).join(" ");return t=this.replaceBBCode(t),t=this.replaceHyperLinks(t),t=this.replaceEmoticons(t),'<span class="privmsg">'+this.lang.privmsg+"</span> "+t},replaceCommandPrivMsgTo:function(e){var t=e.slice(2).join(" ");return t=this.replaceBBCode(t),t=this.replaceHyperLinks(t),t=this.replaceEmoticons(t),'<span class="privmsg">'+this.lang.privmsgto.replace(/%s/,e[1])+"</span> "+t},replaceCommandPrivAction:function(e){var t=e.slice(1).join(" ");return t=this.replaceBBCode(t),t=this.replaceHyperLinks(t),'<span class="action">'+(t=this.replaceEmoticons(t))+'</span> <span class="privmsg">'+this.lang.privmsg+"</span> "},replaceCommandPrivActionTo:function(e){var t=e.slice(2).join(" ");return t=this.replaceBBCode(t),t=this.replaceHyperLinks(t),'<span class="action">'+(t=this.replaceEmoticons(t))+'</span> <span class="privmsg">'+this.lang.privmsgto.replace(/%s/,e[1])+"</span> "},replaceCommandAction:function(e){var t=e.slice(1).join(" ");return t=this.replaceBBCode(t),t=this.replaceHyperLinks(t),'<span class="action">'+(t=this.replaceEmoticons(t))+"</span>"},replaceCommandInvite:function(e){return'<span class="chatBotMessage">'+this.lang.invite.replace(/%s/,e[1]).replace(/%s/,"<a href=\"javascript:ajaxChat.sendMessageWrapper('/join "+this.scriptLinkEncode(e[2])+'\');" title="'+this.lang.joinChannel.replace(/%s/,e[2])+'">'+e[2]+"</a>")+"</span>"},replaceCommandInviteTo:function(e){return'<span class="chatBotMessage">'+this.lang.inviteto.replace(/%s/,e[1]).replace(/%s/,e[2])+"</span>"},replaceCommandUninvite:function(e){return'<span class="chatBotMessage">'+this.lang.uninvite.replace(/%s/,e[1]).replace(/%s/,e[2])+"</span>"},replaceCommandUninviteTo:function(e){return'<span class="chatBotMessage">'+this.lang.uninviteto.replace(/%s/,e[1]).replace(/%s/,e[2])+"</span>"},replaceCommandQueryOpen:function(e){return'<span class="chatBotMessage">'+this.lang.queryOpen.replace(/%s/,e[1])+"</span>"},replaceCommandQueryClose:function(e){return'<span class="chatBotMessage">'+this.lang.queryClose.replace(/%s/,e[1])+"</span>"},replaceCommandIgnoreAdded:function(e){return'<span class="chatBotMessage">'+this.lang.ignoreAdded.replace(/%s/,e[1])+"</span>"},replaceCommandIgnoreRemoved:function(e){return'<span class="chatBotMessage">'+this.lang.ignoreRemoved.replace(/%s/,e[1])+"</span>"},replaceCommandIgnoreList:function(e){return'<span class="chatBotMessage">'+this.lang.ignoreList+" "+this.getInlineUserMenu(e.slice(1))+"</span>"},replaceCommandIgnoreListEmpty:function(e){return'<span class="chatBotMessage">'+this.lang.ignoreListEmpty+"</span>"},replaceCommandKick:function(e){return'<span class="chatBotMessage">'+this.lang.logoutKicked.replace(/%s/,e[1])+"</span>"},replaceCommandWho:function(e){return'<span class="chatBotMessage">'+this.lang.who+" "+this.getInlineUserMenu(e.slice(1))+"</span>"},replaceCommandWhoChannel:function(e){return'<span class="chatBotMessage">'+this.lang.whoChannel.replace(/%s/,e[1])+" "+this.getInlineUserMenu(e.slice(2))+"</span>"},replaceCommandWhoEmpty:function(e){return'<span class="chatBotMessage">'+this.lang.whoEmpty+"</span>"},replaceCommandList:function(e){for(var t,i=e.slice(1),s=[],a=0;a<i.length;a++)t=i[a]===this.channelName?"<b>"+i[a]+"</b>":i[a],s.push("<a href=\"javascript:ajaxChat.sendMessageWrapper('/join "+this.scriptLinkEncode(i[a])+'\');" title="'+this.lang.joinChannel.replace(/%s/,i[a])+'">'+t+"</a>");return'<span class="chatBotMessage">'+this.lang.list+" "+s.join(", ")+"</span>"},replaceCommandBans:function(e){for(var t=e.slice(1),i=[],s=0;s<t.length;s++)i.push("<a href=\"javascript:ajaxChat.sendMessageWrapper('/unban "+this.scriptLinkEncode(t[s])+'\');" title="'+this.lang.unbanUser.replace(/%s/,t[s])+'">'+t[s]+"</a>");return'<span class="chatBotMessage">'+this.lang.bans+" "+i.join(", ")+"</span>"},replaceCommandBansEmpty:function(e){return'<span class="chatBotMessage">'+this.lang.bansEmpty+"</span>"},replaceCommandUnban:function(e){return'<span class="chatBotMessage">'+this.lang.unban.replace(/%s/,e[1])+"</span>"},replaceCommandWhois:function(e){return'<span class="chatBotMessage">'+this.lang.whois.replace(/%s/,e[1])+' <a title="Geolocation" target="_blank" href="http://www.infosniper.net/index.php?ip_address='+e[2]+'">'+e[2]+"</a></span>"},replaceCommandStats:function(e){return this.replaceBBCode(e)},replaceCommandGift:function(e){return this.replaceBBCode(e)},replaceCommandRep:function(e){return this.replaceBBCode(e)},replaceCommandSeen:function(e){return this.replaceBBCode(e)},replaceCommandMentions:function(e){return this.replaceBBCode(e)},replaceCommandCasino:function(e){return this.replaceBBCode(e)},replaceCommandWhereis:function(e){return'<span class="chatBotMessage">'+this.lang.whereis.replace(/%s/,e[1]).replace(/%s/,"<a href=\"javascript:ajaxChat.sendMessageWrapper('/join "+this.scriptLinkEncode(e[2])+'\');" title="'+this.lang.joinChannel.replace(/%s/,e[2])+'">'+e[2]+"</a>")+"</span>"},replaceCommandRoll:function(e){var t=this.lang.roll.replace(/%s/,e[1]);return t=(t=t.replace(/%s/,e[2])).replace(/%s/,e[3]),'<span class="chatBotMessage"><img src="'+ajaxChat.dirs.emoticons+'dice.gif" alt="dice" />'+t+"</span>"},replaceCommandNick:function(e){return'<span class="chatBotMessage">'+this.lang.nick.replace(/%s/,e[1]).replace(/%s/,e[2])+"</span>"},replaceCommandError:function(e){var t=this.lang["error"+e[1]];return t?e.length>2&&(t=t.replace(/%s/,e.slice(2).join(" "))):t="Error: Unknown.",'<span class="chatBotErrorMessage">'+t+"</span>"},getInlineUserMenu:function(e){for(var t="",i=0;i<e.length;i++)i>0&&(t+=", "),t+="<a href=\"javascript:ajaxChat.toggleUserMenu('"+this.getInlineUserMenuDocumentID(this.userMenuCounter,i)+"', '"+this.scriptLinkEncode(e[i])+'\', null);" title="'+this.lang.toggleUserMenu.replace(/%s/,e[i])+'" dir="'+this.baseDirection+'">'+(e[i]===this.userName?"<b>"+e[i]+"</b>":e[i])+'</a><ul class="inlineUserMenu" id="'+this.getInlineUserMenuDocumentID(this.userMenuCounter,i)+'" style="display:none;"></ul>';return this.userMenuCounter++,t},containsUnclosedTags:function(e){var t,i;return t=e.match(/<[^>\/]+?>/gm),i=e.match(/<\/[^>]+?>/gm),!!(!t&&i||t&&!i||t&&i&&t.length!==i.length)},breakLongWords:function(e){var t,i,s,a,n,r;if(!this.settings.wordWrap)return e;for(t="",i=0,r=0;r<e.length;r++)"<"===(s=e.charAt(r))?(a=!0,r>5&&"<br/"===e.substr(r-5,4)&&(i=0)):a&&r>0&&">"===e.charAt(r-1)&&(a=!1,r>4&&"<br/"===e.substr(r-5,4)&&(i=0)),a||"&"!==s?n&&r>0&&";"===e.charAt(r-1)&&(n=!1,i++):n=!0,a||n||(" "===s||"\n"===s||"\t"===s?i=0:i++,i>this.settings.maxWordLength&&(t+="&#8203;",i=0)),t+=s;return t},replaceBBCode:function(e){return this.settings.bbCode?e.replace(/\[(\w+)(?:=([^<>]*?))?\](.+?)\[\/\1\]/gm,this.replaceBBCodeCallback):e.replace(/\[(?:\/)?(\w+)(?:=([^<>]*?))?\]/,"")},replaceBBCodeCallback:function(e,t,i,s){if(!ajaxChat.inArray(ajaxChat.bbCodeTags,t))return e;if(ajaxChat.containsUnclosedTags(s))return e;switch(t){case"color":return ajaxChat.replaceBBCodeColor(s,i);case"url":return ajaxChat.replaceBBCodeUrl(s,i);case"img":return ajaxChat.replaceBBCodeImage(s);case"quote":return ajaxChat.replaceBBCodeQuote(s,i);case"code":return ajaxChat.replaceBBCodeCode(s);case"u":return ajaxChat.replaceBBCodeUnderline(s);case"b":return ajaxChat.replaceBBCodeBold(s);case"i":return ajaxChat.replaceBBCodeItalic(s);default:return ajaxChat.replaceCustomBBCode(t,i,s)}},replaceBBCodeColor:function(e,t){return this.settings.bbCodeColors?'<span style="color:'+t+';">'+this.replaceBBCode(e)+"</span>":e},replaceBBCodeUrl:function(e,t){var i,s,a;if(i=t?t.replace(/\s/gm,this.encodeText(" ")):this.stripBBCodeTags(e.replace(/\s/gm,this.encodeText(" "))),s=new RegExp("^(?:(?:http)|(?:https)|(?:ftp)|(?:irc)):\\/\\/",""),!i||!i.match(s))return e;this.inUrlBBCode=!0;var n=new RegExp(window.location.hostname,"g");return i.match(n)||(i=this.anonymizer+i),a='<a href="'+i+'" onclick="window.open(this.href); return false;">'+this.replaceBBCode(e)+"</a>",this.inUrlBBCode=!1,a},replaceBBCodeImage:function(e){var t,i;return this.settings.bbCodeImages?(t=new RegExp(this.regExpMediaUrl,""),e&&e.match(t)?(e=this.stripTags(e.replace(/\s/gm,this.encodeText(" "))),i='<img class="bbCodeImage" style="max-width:'+(this.dom.chatList.offsetWidth-50)+"px; max-height:"+(this.dom.chatList.offsetHeight-50)+'px;" src="'+e+'" alt="" onload="ajaxChat.updateChatlistView();"/>',this.inUrlBBCode||(i='<a href="'+e+'" onclick="window.open(this.href); return false;">'+i+"</a>"),i):e):e},replaceBBCodeQuote:function(e,t){return t?'<span class="quote"><cite>'+this.lang.cite.replace(/%s/,t)+"</cite><q>"+this.replaceBBCode(e)+"</q></span>":'<span class="quote"><q>'+this.replaceBBCode(e)+"</q></span>"},replaceBBCodeCode:function(e){return"<fieldset class='code'><legend>code</legend>"+this.replaceBBCode(e.replace(/\t|(?:  )/gm,"&#160;&#160;"))+"</fieldset>"},replaceBBCodeUnderline:function(e){return'<span style="text-decoration:underline;">'+this.replaceBBCode(e)+"</span>"},replaceBBCodeBold:function(e){return'<span style="font-weight:bold;">'+this.replaceBBCode(e)+"</span>"},replaceBBCodeItalic:function(e){return'<span style="font-style: italic;">'+this.replaceBBCode(e)+"</span>"},replaceHyperLinks:function(e){var t;if(!this.settings.hyperLinks)return e;t=new RegExp("(^|\\s|>)((?:(?:http)|(?:https)|(?:ftp)|(?:irc)):\\/\\/[^\\s<>]+)(<\\/a>)?","gm");var i=this.anonymizer;return e.replace(t,function(t,s,a,n){if(n)return t;var r=new RegExp(window.location.hostname,"g"),o=e.match(r);return url=o?a:i+a,s+'<a href="'+url+'" onclick="window.open(this.href); return false;">'+a+"</a>"})},replaceLineBreaks:function(e){var t=new RegExp("\\n","g");return this.settings.lineBreaks?e.replace(t,"<br/>"):e.replace(t," ")},replaceEmoticons:function(e){if(!this.settings.emoticons)return e;if(!arguments.callee.regExp){for(var t="^(.*)(",i=0;i<this.emoticonCodes.length;i++)0!==i&&(t+="|"),t+="(?:"+this.escapeRegExp(this.emoticonCodes[i])+")";t+=")(.*)$",arguments.callee.regExp=new RegExp(t,"gm")}return e.replace(arguments.callee.regExp,this.replaceEmoticonsCallback)},replaceEmoticonsCallback:function(e,t,i,s){if(arguments.callee.regExp||(arguments.callee.regExp=new RegExp('(="[^"]*$)|(&[^;]*$)',"")),t.match(arguments.callee.regExp))return e;if(i){var a=ajaxChat.arraySearch(i,ajaxChat.emoticonCodes);return ajaxChat.replaceEmoticons(t)+'<img src="'+ajaxChat.dirs.emoticons+ajaxChat.emoticonFiles[a]+'" alt="'+i+'" />'+ajaxChat.replaceEmoticons(s)}return e},getActiveStyle:function(){var e=this.readCookie(this.sessionKeyPrefix+"style");return e||this.getPreferredStyleSheet()},initStyle:function(){this.styleInitiated=!0,this.setActiveStyleSheet(this.getActiveStyle())},persistStyle:function(){this.styleInitiated&&this.createCookie(this.sessionKeyPrefix+"style",this.getActiveStyleSheet(),this.cookieExpiration)},setSelectedStyle:function(){if(this.dom.styleSelection)for(var e=this.getActiveStyle(),t=this.dom.styleSelection.getElementsByTagName("option"),i=0;i<t.length;i++)if(t[i].value===e){t[i].selected=!0;break}},getSelectedStyle:function(){var e=this.dom.styleSelection.getElementsByTagName("option");return-1===this.dom.styleSelection.selectedIndex?e[0].value:e[this.dom.styleSelection.selectedIndex].value},setActiveStyleSheet:function(e){var t,i,s=!1;for(t=0;i=document.getElementsByTagName("link")[t];t++)-1!==i.getAttribute("rel").indexOf("style")&&i.getAttribute("title")&&(i.disabled=!0,i.getAttribute("title")===e&&(i.disabled=!1,s=!0));s||null===e||this.setActiveStyleSheet(this.getPreferredStyleSheet())},getActiveStyleSheet:function(){var e,t;for(e=0;t=document.getElementsByTagName("link")[e];e++)if(-1!==t.getAttribute("rel").indexOf("style")&&t.getAttribute("title")&&!t.disabled)return t.getAttribute("title");return null},getPreferredStyleSheet:function(){var e,t;for(e=0;t=document.getElementsByTagName("link")[e];e++)if(-1!==t.getAttribute("rel").indexOf("style")&&-1===t.getAttribute("rel").indexOf("alt")&&t.getAttribute("title"))return t.getAttribute("title");return null},switchLanguage:function(e){window.location.search="?lang="+e},createCookie:function(e,t,i){var s="";if(i){var a=new Date;a.setTime(a.getTime()+24*i*60*60*1e3),s="; expires="+a.toUTCString()}var n="; path="+this.cookiePath,r=this.cookieDomain?"; domain="+this.cookieDomain:"",o=this.cookieSecure?"; secure":"";document.cookie=e+"="+encodeURIComponent(t)+s+n+r+o},readCookie:function(e){if(!document.cookie)return null;for(var t=e+"=",i=document.cookie.split(";"),s=0;s<i.length;s++){for(var a=i[s];" "===a.charAt(0);)a=a.substring(1,a.length);if(0===a.indexOf(t))return decodeURIComponent(a.substring(t.length,a.length))}return null},isCookieEnabled:function(){return this.createCookie(this.sessionKeyPrefix+"cookie_test",!0,1),!!this.readCookie(this.sessionKeyPrefix+"cookie_test")&&(this.createCookie(this.sessionKeyPrefix+"cookie_test",!0,-1),!0)},finalize:function(){if("function"==typeof this.finalizeFunction&&this.finalizeFunction(),this.socket)try{this.socket.close(),this.socket=null}catch(e){this.debugMessage("finalize::closeSocket",e)}this.persistSettings(),this.persistStyle(),this.customFinalize()},initializeCustomFlashInterface:function(){},handleCustomInfoMessage:function(e,t){},customInitialize:function(){},customFinalize:function(){},getCustomUserMenuItems:function(e,t){return""},parseCustomInputMessage:function(e){return e},parseCustomInputCommand:function(e,t){return e},replaceCustomText:function(e){return userClass=this.getRoleClass(this.userRole),e=(e=e.replace("bitches","friends")).replace("[username]","["+userClass+"]"+this.userName+"[/"+userClass+"]")},replaceCustomCommands:function(e,t){return e},replaceCustomBBCode:function(e,t,i){return'<span class="'+e+'">'+this.replaceBBCode(i)+"</span>"},customOnNewMessage:function(e,t,i,s,a,n,r,o){return!0},customSoundOnNewMessage:function(e,t,i,s,a,n,r,o){return!0},debugMessage:function(e,t){e="Ajax chat: "+e+" exception: ",this.debug&&(console.log(e,t),2===this.debug&&alert(e+t))}};ajaxChat.logsMonitorMode=null,ajaxChat.logsLastID=null,ajaxChat.logsCommand=null,ajaxChat.startChatUpdate=function(){var e="userID,userName,userRole";this.socketServerEnabled&&(e+=",socketRegistrationID"),this.updateChat("&getInfos="+this.encodeText(e))},ajaxChat.updateChat=function(e){if(e||this.logsMonitorMode||!this.logsLastID||this.lastID!=this.logsLastID){this.logsLastID=this.lastID;var t=this.ajaxURL+"&lastID="+this.lastID;e&&(t+=e),t+="&"+this.getLogsCommand(),this.makeRequest(t,"GET",null)}else this.logsLastID=null},ajaxChat.sendMessage=function(){this.getLogs()},ajaxChat.getLogs=function(){clearTimeout(this.timer),this.clearChatList(),this.lastID=0,this.logsCommand=null,this.makeRequest(this.ajaxURL,"POST",this.getLogsCommand())},ajaxChat.getLogsCommand=function(){return this.logsCommand||(!this.dom.inputField.value&&parseInt(this.dom.yearSelection.value)<=0&&parseInt(this.dom.hourSelection.value)<=0?this.logsMonitorMode=!0:this.logsMonitorMode=!1,this.logsCommand="command=getLogs&channelID="+this.dom.channelSelection.value+"&year="+this.dom.yearSelection.value+"&month="+this.dom.monthSelection.value+"&day="+this.dom.daySelection.value+"&hour="+this.dom.hourSelection.value+"&search="+this.encodeText(this.dom.inputField.value)),this.logsCommand},ajaxChat.onNewMessage=function(e,t,i,s,a,n,r,o){return 0!=n.indexOf("/delete")&&(this.logsMonitorMode&&(this.blinkOnNewMessage(e,t,i,s,a,n,r,o),this.playSoundOnNewMessage(e,t,i,s,a,n,r,o)),!0)},ajaxChat.logout=function(){clearTimeout(this.timer)},ajaxChat.switchLanguage=function(e){window.location.search="?view=logs&lang="+e},ajaxChat.setChatUpdateTimer=function(){var e;clearTimeout(this.timer),this.socketIsConnected&&this.logsLastID&&this.lastID==this.logsLastID?e=this.socketTimerRate:(e=this.timerRate,this.socketServerEnabled&&!this.socketReconnectTimer&&(this.socketReconnectTimer=setTimeout("ajaxChat.socketConnect();",6e4))),this.timer=setTimeout("ajaxChat.updateChat(null);",e)},ajaxChat.socketUpdate=function(e){if(this.logsMonitorMode){var t=this.loadXML(e);if(t){var i=parseInt(this.dom.channelSelection.value),s=parseInt(t.firstChild.getAttribute("channelID"));(-3==i||s==i||-2==i&&s>=this.privateMessageDiff||-1==i&&s>=this.privateChannelDiff&&s<this.privateMessageDiff)&&this.handleChatMessages(t.getElementsByTagName("message"))}}};var ajaxChatLang={login:"%s logs into the Chat.",logout:"%s logs out of the Chat.",logoutTimeout:"%s has been logged out (Timeout).",logoutIP:"%s has been logged out (Invalid IP address).",logoutKicked:"%s has been logged out (Kicked).",channelEnter:"%s enters the channel.",channelLeave:"%s leaves the channel.",privmsg:"(whispers)",privmsgto:"(whispers to %s)",invite:"%s invites you to join %s.",inviteto:"Your invitation to %s to join channel %s has been sent.",uninvite:"%s uninvites you from channel %s.",uninviteto:"Your uninvitation to %s for channel %s has been sent.",queryOpen:"Private channel opened to %s.",queryClose:"Private channel to %s closed.",ignoreAdded:"Added %s to the ignore list.",ignoreRemoved:"Removed %s from the ignore list.",ignoreList:"Ignored Users:",ignoreListEmpty:"No ignored Users listed.",who:"Online Users:",whoChannel:"Online Users in channel %s:",whoEmpty:"No online users in the given channel.",list:"Available channels:",bans:"Banned Users:",bansEmpty:"No banned Users listed.",unban:"Ban of user %s revoked.",whois:"User %s - IP address:",whereis:"User %s is in channel %s.",roll:"%s rolls %s and gets %s.",nick:"%s is now known as %s.",toggleUserMenu:"Toggle user menu for %s",userMenuLogout:"Logout",userMenuWho:"List online users",userMenuList:"List available channels",userMenuAction:"Describe action",userMenuRoll:"Roll dice",userMenuNick:"Change username",userMenuEnterPrivateRoom:"Enter private room",userMenuSendPrivateMessage:"Send private message",userMenuDescribe:"Send private action",userMenuOpenPrivateChannel:"Open private channel",userMenuClosePrivateChannel:"Close private channel",userMenuInvite:"Invite",userMenuUninvite:"Uninvite",userMenuIgnore:"Ignore/Accept",userMenuIgnoreList:"List ignored users",userMenuWhereis:"Display channel",userMenuKick:"Kick/Ban",userMenuBans:"List banned users",userMenuWhois:"Display IP",unbanUser:"Revoke ban of user %s",joinChannel:"Join channel %s",cite:"%s said:",urlDialog:"Please enter the address (URL) of the webpage:",deleteMessage:"Delete this chat message",deleteMessageConfirm:"Really delete the selected chat message?",errorCookiesRequired:"Cookies are required for this chat.",errorUserNameNotFound:"Error: User %s not found.",errorMissingText:"Error: Missing message text.",errorMissingUserName:"Error: Missing username.",errorInvalidUserName:"Error: Invalid username.",errorUserNameInUse:"Error: Username already in use.",errorMissingChannelName:"Error: Missing channel name.",errorInvalidChannelName:"Error: Invalid channel name: %s",errorPrivateMessageNotAllowed:"Error: Private messages are not allowed.",errorInviteNotAllowed:"Error: You are not allowed to invite someone to this channel.",errorUninviteNotAllowed:"Error: You are not allowed to uninvite someone from this channel.",errorNoOpenQuery:"Error: No private channel open.",errorKickNotAllowed:"Error: You are not allowed to kick %s.",errorCommandNotAllowed:"Error: Command not allowed: %s",errorUnknownCommand:"Error: Unknown command: %s",errorMaxMessageRate:"Error: You exceeded the maximum number of messages per minute.",errorConnectionTimeout:"Error: Connection timeout. Please try again.",errorConnectionStatus:"Error: Connection status: %s",errorSoundIO:"Error: Failed to load sound file (Flash IO Error).",errorSocketIO:"Error: Connection to socket server failed (Flash IO Error).",errorSocketSecurity:"Error: Connection to socket server failed (Flash Security Error).",errorDOMSyntax:"Error: Invalid DOM Syntax (DOM ID: %s)."},UC_USER=0,UC_POWER_USER=1,UC_VIP=2,UC_UPLOADER=3,UC_MODERATOR=4,UC_STAFF=4,UC_ADMINISTRATOR=5,UC_SYSOP=6,ajaxChatConfig={loginChannelID:null,loginChannelName:null,timerRate:2e3,ajaxURL:"./ajaxchat.php?ajax=true",baseURL:"./chat/",regExpMediaUrl:"^((http)|(https)):\\/\\/",startChatOnLoad:!0,domIDs:{chatList:"chatList",onlineList:"onlineList",inputField:"inputField",messageLengthCounter:"messageLengthCounter",channelSelection:"channelSelection",styleSelection:"styleSelection",emoticonsContainer:"emoticonsContainer",colorCodesContainer:"colorCodesContainer",flashInterfaceContainer:"flashInterfaceContainer",statusIcon:"statusIconContainer"},settings:{postDirection:!1,bbCode:!0,bbCodeImages:!0,bbCodeColors:!0,hyperLinks:!0,lineBreaks:!0,emoticons:!0,autoFocus:!1,autoScroll:!0,maxMessages:0,wordWrap:!0,maxWordLength:32,dateFormat:"[%H:%i:%s]",dateFormatTooltip:"%l, %F %d, %Y",persistFontColor:!1,fontColor:null,audio:!0,audioBackend:0,audioVolume:.3,soundReceive:"sound_1",soundSend:"sound_2",soundEnter:"sound_3",soundLeave:"sound_4",soundChatBot:"sound_5",soundError:"sound_6",soundPrivate:"sound_7",blink:!0,blinkInterval:500,blinkIntervalNumber:10},nonPersistentSettings:[],bbCodeTags:["b","i","u","quote","code","color","url","img","chatbot","user","power_user","vip","uploader","moderator","administrator","sysop"],colorCodes:["gray","silver","white","yellow","orange","red","fuchsia","purple","navy","blue","aqua","teal","green","lime","olive","maroon","black"],emoticonCodes:[":)",":smile:",":-D",":lol:",":w00t:",":-P",":blum:",";-)",":devil:",":yawn:",":-/",":o)",":innocent:",":whistle:",":unsure:",":blush:",":hmm:",":hmmm:",":huh:",":look:",":rolleyes:",":kiss:",":blink:",":baby:",":hi2:",":pmsl:",":-)",":smile:",":-D",":lol:",":w00t:",":-P",";-)",":-|",":-/",":-(",":'-(",":weep:",":-O",":o)","8-)","|-)",":innocent:",":whistle:",":closedeyes:",":cool:",":fun:",":unsure:",":thumbsup:",":thumbsdown:",":blush:",":yes:",":no:",":love:",":?:",":!:",":idea:",":arrow:",":hmm:",":hmmm:",":huh:",":geek:",":look:",":rolleyes:",":kiss:",":shifty:",":blink:",":smartass:",":sick:",":crazy:",":wacko:",":alien:",":wizard:",":wave:",":wavecry:",":baby:",":angry:",":ras:",":sly:",":devil:",":evil:",":evilmad:",":sneaky:",":axe:",":slap:",":wall:",":rant:",":jump:",":yucky:",":nugget:",":smart:",":shutup:",":shutup2:",":crockett:",":zorro:",":snap:",":beer:",":beer2:",":drunk:",":strongbench:",":weakbench:",":dumbells:",":music:",":stupid:",":dots:",":offtopic:",":spam:",":oops:",":lttd:",":please:",":sorry:",":hi:",":yay:",":cake:",":hbd:",":band:",":punk:",":rofl:",":bounce:",":mbounce:",":gathering:",":hang:",":chop:",":horny:",":rip:",":whip:",":judge:",":chair:",":tease:",":box:",":boxing:",":guns:",":shoot:",":shoot2:",":flowers:",":wub:",":lovers:",":kissing:",":kissing2:",":console:",":group:",":hump:",":hooray:",":happy2:",":clap:",":clap2:",":weirdo:",":yawn:",":bow:",":dawgie:",":cylon:",":book:",":fish:",":mama:",":pepsi:",":medieval:",":rambo:",":ninja:",":hannibal:",":party:",":snorkle:",":evo:",":king:",":chef:",":mario:",":pope:",":fez:",":cap:",":cowboy:",":pirate:",":pirate2:",":rock:",":cigar:",":icecream:",":oldtimer:",":trampoline:",":banana:",":smurf:",":yikes:",":osama:",":saddam:",":santa:",":indian:",":pimp:",":nuke:",":jacko:",":ike:",":greedy:",":super:",":wolverine:",":spidey:",":spider:",":bandana:",":construction:",":sheep:",":police:",":detective:",":bike:",":fishing:",":clover:",":horse:",":shit:",":soldiers:",":)",":wink:",":D",":P",":(",":'(",":|",":Boozer:",":deadhorse:",":spank:",":yoji:",":locked:",":grrr:","O:-",":sleeping:",":clown:",":mml:",":rtf:",":dancer:",":morepics:",":rb:",":rblocked:",":maxlocked:",":hslocked:",":thankyou:",":congrat:",":thedevil:",":drinks2:",":rose:",":good:",":hi2:",":pardon:",":rofl2:",":spite:",":unknw:",":cuppa:",":smoken:",":slick:",":sun:",":fart2:",":lurker:",":jawdrop:",":sob:",":whip2:",":geek2:",":madgrin:",":byebye:",":img:",":alcohol:",":pmsl:",":bombie:",":whoops:",":banned:",":faq:",":iluvff:",":starwars:",":mage:",":respect:",":utorrent:",":spliffy:",":bear:",":bandit:",":congrats:",":smokin:",":canabis:",":2gun:",":bigun:",":chainsaw:",":drinks:",":fight1:",":fight2:",":fight3:",":fight4:",":first:",":Gotcha:",":jumping:",":yoda:",":wink1:",":upyours:",":taz:",":spew2:",":spew:",":sniper1:",":smokie2:",":sick2:",":scream:",":rasp2:",":rasp:",":party8:",":party7:",":party6:",":party5:",":party4:",":party3:",":party2:",":party1:",":oldman:",":ninja2:",":madaRse:",":line:",":last:",":kenny:",":jumping3:",":jumping2:",":jumping1:",":pish:",":grim:",":taz2:",":spiderman:",":bong:",":bat:",":shotgun:",":eye:",":tumble:",":welcome:",":fart3:",":caveman:",":explode:",":finger:",":bhong:",":bye:",":slip:",":jerry:",":schair:",":raver:",":ras2:",":moonie:",":hides:",":apache:",":doobie:",":acid:",":angeldevil:",":madraver:",":clapper1:",":high5:",":shoutkiller:",":bhong3:",":bomb:",":grey:",":fart:",":trumpet:",":lmfao:",":flmao:",":googleit:",":wow:",":karma:",":king2:",":king3:",":astronomer:",":bluesbro:",":Bunny:",":cookies:",":wired:",":elektrik:",":boom:",":firebug:",":fishy:",":fishy2:",":graffiti:",":glue:",":goodjob:",":googleb:",":grasshopper:",":hint:",":magnify:",":mini2:",":mini3:",":mini4:",":moo:",":muhaha:",":fubar:",":nhlfan:",":oldman2:",":omg:",":peacock:",":pottymouth:",":salute:",":scuba2:",":scythe:",":shadowpet:",":sharky:",":sheesh:",":smmdi:",":boader:",":soapbox1:",":shappens:",":swinger:",":talk2:",":usd:",":wanted:",":clowny:",":angry_skull:",":cheesy_skull:",":cool_skull:",":cry_skull:",":embarassed_skull:",":grin_skull:",":huh_skull:",":kiss_skull:",":laugh_skull:",":lipsrsealed_skull:",":rolleyes_skull:",":sad_skull:",":shocked_skull:",":smiley_skull:",":tongue_skull:",":undecided_skull:",":wink_skull:",":fart4:",":Boozer:",":deadhorse:",":headbang:",":bump:",":spank:",":yoji:",":grrr:",":mml:",":rtf:",":morepics:",":rb:",":rblocked:",":maxlocked:",":hslocked:",":locked:",":censoredpic:",":dabunnies:"],emoticonFiles:["smile1.gif","smile2.gif","grin.gif","laugh.gif","w00t.gif","tongue.gif","blum.gif","wink.gif","devil.gif","yawn.gif","confused.gif","clown.gif","innocent.gif","whistle.gif","unsure.gif","blush.gif","hmm.gif","hmmm.gif","huh.gif","look.gif","rolleyes.gif","kiss.gif","blink.gif","baby.gif","hi2.gif","hysterical.gif","smile1.gif","smile2.gif","grin.gif","laugh.gif","w00t.gif","tongue.gif","wink.gif","noexpression.gif","confused.gif","sad.gif","cry.gif","weep.gif","ohmy.gif","clown.gif","cool1.gif","sleeping.gif","innocent.gif","whistle.gif","closedeyes.gif","cool2.gif","fun.gif","unsure.gif","thumbsup.gif","thumbsdown.gif","blush.gif","yes.gif","no.gif","love.gif","question.gif","excl.gif","idea.gif","arrow.gif","hmm.gif","hmmm.gif","huh.gif","geek.gif","look.gif","rolleyes.gif","kiss.gif","shifty.gif","blink.gif","smartass.gif","sick.gif","crazy.gif","wacko.gif","alien.gif","wizard.gif","wave.gif","wavecry.gif","baby.gif","angry.gif","ras.gif","sly.gif","devil.gif","evil.gif","evilmad.gif","sneaky.gif","axe.gif","slap.gif","wall.gif","rant.gif","jump.gif","yucky.gif","nugget.gif","smart.gif","shutup.gif","shutup2.gif","crockett.gif","zorro.gif","snap.gif","beer.gif","beer2.gif","drunk.gif","strongbench.gif","weakbench.gif","dumbells.gif","music.gif","stupid.gif","dots.gif","offtopic.gif","spam.gif","oops.gif","lttd.gif","please.gif","sorry.gif","hi.gif","yay.gif","cake.gif","hbd.gif","band.gif","punk.gif","rofl.gif","bounce.gif","mbounce.gif","gathering.gif","hang.gif","chop.gif","horny.gif","rip.gif","whip.gif","judge.gif","chair.gif","tease.gif","box.gif","boxing.gif","guns.gif","shoot.gif","shoot2.gif","flowers.gif","wub.gif","lovers.gif","kissing.gif","kissing2.gif","console.gif","group.gif","hump.gif","hooray.gif","happy2.gif","clap.gif","clap2.gif","weirdo.gif","yawn.gif","bow.gif","dawgie.gif","cylon.gif","book.gif","fish.gif","mama.gif","pepsi.gif","medieval.gif","rambo.gif","ninja.gif","hannibal.gif","party.gif","snorkle.gif","evo.gif","king.gif","chef.gif","mario.gif","pope.gif","fez.gif","cap.gif","cowboy.gif","pirate.gif","pirate2.gif","rock.gif","cigar.gif","icecream.gif","oldtimer.gif","trampoline.gif","bananadance.gif","smurf.gif","yikes.gif","osama.gif","saddam.gif","santa.gif","indian.gif","pimp.gif","nuke.gif","jacko.gif","ike.gif","greedy.gif","super.gif","wolverine.gif","spidey.gif","spider.gif","bandana.gif","construction.gif","sheep.gif","police.gif","detective.gif","bike.gif","fishing.gif","clover.gif","horse.gif","shit.gif","soldiers.gif","smile1.gif","wink.gif","grin.gif","tongue.gif","sad.gif","cry.gif","noexpression.gif","alcoholic.gif","deadhorse.gif","spank.gif","yoji.gif","locked.gif","angry.gif","innocent.gif","sleeping.gif","clown.gif","mml.gif","rtf.gif","dancer.gif","morepics.gif","rb.gif","rblocked.gif","maxlocked.gif","hslocked.gif","thankyou.gif","clapping2.gif","diablo.gif","drinks2.gif","give_rose.gif","good.gif","hi2.gif","pardon.gif","rofl2.gif","spiteful.gif","unknw.gif","cuppa.gif","smoke2.gif","uber.gif","read.gif","fart2.gif","lurker.gif","jawdrop.gif","sob.gif","whip2.gif","geek2.gif","mad-grin.gif","connie_mini_byebye.gif","img.gif","alcohol.gif","hysterical.gif","bomb_ie.gif","whoops.gif","banned.gif","faq.gif","iluvff.gif","starwars.gif","mage.gif","respect.gif","utorrent.gif","spliffy.gif","bear.gif","bandit.gif","congrats.gif","smokin.gif","canabis.gif","2gun.gif","biggun.gif","chainsaw2.gif","drinks.gif","fight1.gif","fight2.gif","fight3.gif","fight4.gif","first.gif","Gotcha.gif","jumping.gif","yoda.gif","wink1.gif","upyours.gif","taz.gif","spew2.gif","spew.gif","sniper1.gif","smokie2.gif","sick2.gif","scream.gif","rasp2.gif","rasp.gif","party8.gif","party7.gif","party6.gif","party5.gif","party4.gif","party3.gif","party2.gif","party1.gif","oldman.gif","ninja2.gif","madarse.gif","Line.gif","last.gif","kenny.gif","jumping3.gif","jumping2.gif","jumping1.gif","pish.gif","grim.gif","taz2.gif","spidey.gif","bong.gif","bat.gif","shotgun.gif","eye.gif","tumbleweed.gif","welcome.gif","fart3.gif","caveman.gif","explode.gif","finger.gif","bhong.gif","bye.gif","slip.gif","jerry.gif","schair.gif","raver.gif","ras2.gif","moonie.gif","hides.gif","apache.gif","doobie.gif","acid.gif","angeldevil.gif","madraver.gif","clapper1.gif","high5.gif","shoutkiller.gif","bhong3.gif","bomb.gif","grey.gif","fart.gif","trumpet.gif","lmfao.gif","lmao2.gif","googleit.gif","wow.gif","karma.gif","2nd.gif","3rd.gif","astronomer1.gif","bluesbro.gif","bunnywalk.gif","cookies.gif","electrician.gif","elektrik.gif","explosion.gif","firebug.gif","fishtale.gif","fishy.gif","graffiti.gif","glueb.gif","goodjob.gif","googleb.gif","grasshopper.gif","hint.gif","magglass.gif","mini2.gif","mini3.gif","mini4.gif","moo.gif","muah.gif","likefoobar.gif","nhlfan.gif","old.gif","OMG_sign.gif","peacock.gif","pottymouth.gif","salute3.gif","scuba2.gif","scythe.gif","shadowpets.gif","sharkycircle.gif","sheesh.gif","shemademedoit.gif","skateboardb.gif","soapbox1.gif","stuffhappens.gif","swinger1.gif","talk2.gif","usd.gif","wanted.gif","mindless.gif","angry_skull.gif","cheesy_skull.gif","cool_skull.gif","cry_skull.gif","embarassed_skull.gif","grin_skull.gif","huh_skull.gif","kiss_skull.gif","laugh_skull.gif","lipsrsealed_skull.gif","rolleyes_skull.gif","sad_skull.gif","shocked_skull.gif","smiley_skull.gif","tongue_skull.gif","undecided_skull.gif","wink_skull.gif","fart4.gif","alcoholic.gif","deadhorse.gif","headbang.gif","halo.gif","spank.gif","yoji.gif","angry.gif","mml.gif","rtf.gif","morepics.gif","rb.gif","rblocked.gif","maxlocked.gif","hslocked.gif","locked.gif","boucher-censored.jpg","bunnies3.gif"],emoticonDisplay:[2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,0],soundFiles:{sound_1:"sound_1.mp3",sound_2:"sound_2.mp3",sound_3:"sound_3.mp3",sound_4:"sound_4.mp3",sound_5:"sound_5.mp3",sound_6:"sound_6.mp3",sound_7:"sound_7.mp3"},debug:!1};function FABridge(e,t){return this.target=e,this.remoteTypeCache={},this.remoteInstanceCache={},this.remoteFunctionCache={},this.localFunctionCache={},this.bridgeID=FABridge.nextBridgeID++,this.name=t,this.nextLocalFuncID=0,FABridge.instances[this.name]=this,FABridge.idMap[this.bridgeID]=this,this}function instanceFactory(e){return this.fb_instance_id=e,this}function FABridge__invokeJSFunction(e){var t=e[0],i=e.concat();return i.shift(),FABridge.extractBridgeFromID(t).invokeLocalFunction(t,i)}function FABridge__bridgeInitialized(e){var t=document.getElementsByTagName("object"),i=t.length,s=[];if(i>0)for(var a=0;a<i;a++)void 0!==t[a].SetVariable&&(s[s.length]=t[a]);var n=document.getElementsByTagName("embed"),r=n.length,o=[];if(r>0)for(var l=0;l<r;l++)void 0!==n[l].SetVariable&&(o[o.length]=n[l]);var h=s.length,c=o.length,u="bridgeName="+e;if(1==h&&!c||1==h&&1==c)FABridge.attachBridge(s[0],e);else if(1!=c||h){var d=!1;if(h>1)for(var g=0;g<h;g++){for(var f=s[g].childNodes,p=0;p<f.length;p++){var m=f[p];if(1==m.nodeType&&"param"==m.tagName.toLowerCase()&&"flashvars"==m.name.toLowerCase()&&m.value.indexOf(u)>=0){FABridge.attachBridge(s[g],e),d=!0;break}}if(d)break}if(!d&&c>1)for(var C=0;C<c;C++){if(o[C].attributes.getNamedItem("flashVars").nodeValue.indexOf(u)>=0){FABridge.attachBridge(o[C],e);break}}}else FABridge.attachBridge(o[0],e);return!0}FABridge.TYPE_ASINSTANCE=1,FABridge.TYPE_ASFUNCTION=2,FABridge.TYPE_JSFUNCTION=3,FABridge.TYPE_ANONYMOUS=4,FABridge.initCallbacks={},FABridge.argsToArray=function(e){for(var t=[],i=0;i<e.length;i++)t[i]=e[i];return t},FABridge.addInitializationCallback=function(e,t){var i=FABridge.instances[e];if(void 0==i){var s=FABridge.initCallbacks[e];null==s&&(FABridge.initCallbacks[e]=s=[]),s.push(t)}else t.call(i)},FABridge.nextBridgeID=0,FABridge.instances={},FABridge.idMap={},FABridge.refCount=0,FABridge.extractBridgeFromID=function(e){var t=e>>16;return FABridge.idMap[t]},FABridge.attachBridge=function(e,t){var i=new FABridge(e,t);FABridge[t]=i;var s=FABridge.initCallbacks[t];if(null!=s){for(var a=0;a<s.length;a++)s[a].call(i);delete FABridge.initCallbacks[t]}},FABridge.blockedMethods={toString:!0,get:!0,set:!0,call:!0},FABridge.prototype={root:function(){return this.deserialize(this.target.getRoot())},releaseASObjects:function(){return this.target.releaseASObjects()},releaseNamedASObject:function(e){return"object"==typeof e&&this.target.releaseNamedASObject(e.fb_instance_id)},create:function(e){return this.deserialize(this.target.create(e))},makeID:function(e){return(this.bridgeID<<16)+e},getPropertyFromAS:function(e,t){if(FABridge.refCount>0)throw new Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");FABridge.refCount++;var i=this.target.getPropFromAS(e,t);return i=this.handleError(i),FABridge.refCount--,i},setPropertyInAS:function(e,t,i){if(FABridge.refCount>0)throw new Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");FABridge.refCount++;var s=this.target.setPropInAS(e,t,this.serialize(i));return s=this.handleError(s),FABridge.refCount--,s},callASFunction:function(e,t){if(FABridge.refCount>0)throw new Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");FABridge.refCount++;var i=this.target.invokeASFunction(e,this.serialize(t));return i=this.handleError(i),FABridge.refCount--,i},callASMethod:function(e,t,i){if(FABridge.refCount>0)throw new Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");FABridge.refCount++,i=this.serialize(i);var s=this.target.invokeASMethod(e,t,i);return s=this.handleError(s),FABridge.refCount--,s},invokeLocalFunction:function(e,t){var i,s=this.localFunctionCache[e];return void 0!=s&&(i=this.serialize(s.apply(null,this.deserialize(t)))),i},getTypeFromName:function(e){return this.remoteTypeCache[e]},createProxy:function(e,t){instanceFactory.prototype=this.getTypeFromName(t);var i=new instanceFactory(e);return this.remoteInstanceCache[e]=i,i},getProxy:function(e){return this.remoteInstanceCache[e]},addTypeDataToCache:function(e){for(var t=new ASProxy(this,e.name),i=e.accessors,s=0;s<i.length;s++)this.addPropertyToType(t,i[s]);var a=e.methods;for(s=0;s<a.length;s++)void 0==FABridge.blockedMethods[a[s]]&&this.addMethodToType(t,a[s]);return this.remoteTypeCache[t.typeName]=t,t},addPropertyToType:function(e,t){var i,s,a=t.charAt(0);a>="a"&&a<="z"?(s="get"+a.toUpperCase()+t.substr(1),i="set"+a.toUpperCase()+t.substr(1)):(s="get"+t,i="set"+t),e[i]=function(e){this.bridge.setPropertyInAS(this.fb_instance_id,t,e)},e[s]=function(){return this.bridge.deserialize(this.bridge.getPropertyFromAS(this.fb_instance_id,t))}},addMethodToType:function(e,t){e[t]=function(){return this.bridge.deserialize(this.bridge.callASMethod(this.fb_instance_id,t,FABridge.argsToArray(arguments)))}},getFunctionProxy:function(e){var t=this;return null==this.remoteFunctionCache[e]&&(this.remoteFunctionCache[e]=function(){t.callASFunction(e,FABridge.argsToArray(arguments))}),this.remoteFunctionCache[e]},getFunctionID:function(e){return void 0==e.__bridge_id__&&(e.__bridge_id__=this.makeID(this.nextLocalFuncID++),this.localFunctionCache[e.__bridge_id__]=e),e.__bridge_id__},serialize:function(e){var t={},i=typeof e;if("number"==i||"string"==i||"boolean"==i||null==i||void 0==i)t=e;else if(e instanceof Array){t=[];for(var s=0;s<e.length;s++)t[s]=this.serialize(e[s])}else"function"==i?(t.type=FABridge.TYPE_JSFUNCTION,t.value=this.getFunctionID(e)):e instanceof ASProxy?(t.type=FABridge.TYPE_ASINSTANCE,t.value=e.fb_instance_id):(t.type=FABridge.TYPE_ANONYMOUS,t.value=e);return t},deserialize:function(e){var t,i=typeof e;if("number"==i||"string"==i||"boolean"==i||null==e||void 0==e)t=this.handleError(e);else if(e instanceof Array){t=[];for(var s=0;s<e.length;s++)t[s]=this.deserialize(e[s])}else if("object"==i){for(s=0;s<e.newTypes.length;s++)this.addTypeDataToCache(e.newTypes[s]);for(var a in e.newRefs)this.createProxy(a,e.newRefs[a]);e.type==FABridge.TYPE_PRIMITIVE?t=e.value:e.type==FABridge.TYPE_ASFUNCTION?t=this.getFunctionProxy(e.value):e.type==FABridge.TYPE_ASINSTANCE?t=this.getProxy(e.value):e.type==FABridge.TYPE_ANONYMOUS&&(t=e.value)}return t},addRef:function(e){this.target.incRef(e.fb_instance_id)},release:function(e){this.target.releaseRef(e.fb_instance_id)},handleError:function(e){if("string"==typeof e&&0==e.indexOf("__FLASHERROR")){var t=e.split("||");throw FABridge.refCount>0&&FABridge.refCount--,new Error(t[1])}return e}},ASProxy=function(e,t){return this.bridge=e,this.typeName=t,this},ASProxy.prototype={get:function(e){return this.bridge.deserialize(this.bridge.getPropertyFromAS(this.fb_instance_id,e))},set:function(e,t){this.bridge.setPropertyInAS(this.fb_instance_id,e,t)},call:function(e,t){this.bridge.callASMethod(this.fb_instance_id,e,t)},addRef:function(){this.bridge.addRef(this)},release:function(){this.bridge.release(this)}};